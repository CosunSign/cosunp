<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>加班单</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap.css">
    <script src="/lib/jquery-3.3.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap-select.min.css">
    <script type="text/javascript" src="../static/lib/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/lib/bootstrap/js/bootstrap-select.min.js"></script>
    <script src="/lib/WdatePicker.js" type="text/javascript"></script>
    <script src="/lib/defaults-zh_CN.js" type="text/javascript"></script>
</head>
<style type="text/css">
    td, th {
        white-space: nowrap;
    }
</style>
<script>

    $(function () {
        window.parent.document.getElementById('content').style.display = "block";
        window.parent.document.getElementById('contentnew').style.display = "none";
        var flag = $("#flag").val();
        var aflag = eval(flag)
        if (aflag == 1) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;添加成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 2) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;删除成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 3) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;更改成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 4) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;查询成功!";
            errormessagediv.style.color = "green";
        }
    });

    function goPageone() {
        $("#n_currentPage").val(1);
        queryJBByCondition();
    }

    function goPrePage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 - 1 * 1);
        queryJBByCondition();
    }

    function goAftPage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 + 1 * 1);
        queryJBByCondition();
    }

    function goMaxPage() {
        $("#n_currentPage").val($("#maxPage").val());
        queryJBByCondition();
    }

    function isNull(arg1) {
        if (arg1 == "null" || arg1 == null || arg1 == 0 || arg1 == "0") {
            return "";
        }
        return arg1;
    }

    function goPage2() {
        var tp = document.getElementById("_tp").value;//currentPage
        var max = $("#maxPage").val(); //maxPage
        tp = tp.trim();
        var r = /^\+?[0-9][0-9]*$/;
        if (!(r.test(tp))) {
            alert("页数输入有误，请重新输入!");
            $("#_tp").val(max);
            return false;
        } else if (parseInt(tp) == 0) {
            alert("页数必须大于0!");
            $("#_tp").val(max);
            return false;
        } else if (parseInt(tp) > parseInt(max)) {
            alert("不能大于总页数!");
            $("#_tp").val(max);
            return false;
        } else {
            $("#n_currentPage").val(tp);
            // document.forms["form0"].submit();
            queryJBByCondition();
        }
    }

    function goPriAftPage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 + 1 * 1);
        queryJBByCondition();
    }

    function goPriMaxPage() {
        $("#n_currentPage").val($("#maxPage").val());
        queryJBByCondition();
    }

    function goPriPrePage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 - 1 * 1);
        queryJBByCondition();
    }

    var currentPage; //当前页
    var totalPage; //总多少页
    var totaldata; //总共多少记录
    var pageSize;//当前每页多少条
    function queryJBByCondition() {
        var currentpage = $("#n_currentPage").val();
        window.parent.document.getElementById('coverbehidepage').style.display = "block";
        var formData = new FormData();
        formData.append('names', $("#name").val());
        formData.append('empNo', $("#empNo").val());
        formData.append('deptIds', $("#deptId").val());
        formData.append('positionIds', $("#positionId").val());
        formData.append('extDateFromStr', $("#startLeaveId").val());
        formData.append('extDateEndStr', $("#endLeaveId").val());
        formData.append('types', $("#leaveType").val());
        formData.append('currentPage', currentpage);
        $.ajax({
            data: formData,
            type: "POST",
            url: "/person/queryJBByCondition",
            async: true,
            cache: false,
            contentType: false,
            processData: false,
            success: function (msg) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;查询成功!";
                errormessagediv.style.color = "green";
                var data = eval(msg);//将msg化为数;
                var tr = "";
                var image01 = $("#image01");
                var image02 = $("#image02");
                var image03 = $("#image03");
                var image04 = $("#image04");
                var maxpageid = $("#maxPage");
                var n_currentPage = $("#n_currentPage");
                var inputpage = $("#_tp");
                image01.html("");
                image02.html("");
                image03.html("");
                image04.html("");
                var td = "";
                var tbody = $("#tabletblody");
                tbody.html("");
                if (data != null && data != "") {
                    $("#nodatadiv").hide();
                    $("#showdiv").show();
                    currentPage = data[0].currentPage; //当前页
                    totalPage = data[0].maxPage; //总多少页
                    totaldata = data[0].recordCount; //总共多少记录
                    pageSize = data[0].pageSize;
                    maxpageid.val(totalPage);
                    n_currentPage.val(currentPage);
                    inputpage.val(currentPage);
                    $.each(data, function (num) {
                            tr = $("<tr id='" + data[num].id + "'></tr>");
                            tr.append("<td>" + ((num + 1) + ((n_currentPage.val() - 1) * pageSize)) + "</td>");
                            tr.append("<td>" + isNull(data[num].name) + "</td>");
                            tr.append("<td>" + isNull(data[num].deptName) + "</td>");
                            tr.append("<td>" + isNull(data[num].extDateFromStr) + "</td>");
                            tr.append("<td>" + isNull(data[num].extDateEndStr) + "</td>");
                            tr.append("<td>" + isNull(data[num].extWorkHours) + "</td>");
                            tr.append("<td>" + isNull(data[num].typeStr) + "</td>");
                            tr.append("<td>" + isNull(data[num].remark) + "</td>");
                            td = "<td>";
                            td += " <a href=\"javascript:void(0);\"\n" +
                                "  onclick=\"saveJiaBanDateToMysql(this);\">保存</a>\n" +
                                "  <a href=\"javascript:void(0);\"\n" +
                                "   onclick=\"deleteJiaBanDateToMysql(" + data[num].id + ");\">删除</a></td>";
                            tr.append(td);
                            tr.appendTo(tbody);
                        }
                    );
                    $("#currentpagespan").html(currentPage);
                    $("#maxpagespan").html(totalPage);
                    $("#recordcountspan").html(totaldata);
                    if (currentPage > 1) {
                        var imange01str = '<img src="/images/page/sy-2.jpg"  onClick="goPriPageone()"  align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange01str += '<img src="/images/page/syy-2.jpg" onClick="goPriPrePage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image01.html(imange01str);
                    } else {
                        image01.html("");
                    }
                    if (currentPage <= 1) {
                        var image02str = '<img src="/images/page/l-sy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image02str += ' <img src="/images/page/l-syy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image02.html(image02str);
                    } else {
                        image02.html("");
                    }
                    if (currentPage < totalPage) {
                        var imange03str = '<img src="/images/page/xyy-2.jpg" onClick="goPriAftPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange03str += '<img src="/images/page/my-2.jpg" onClick="goPriMaxPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image03.html(imange03str);
                    } else {
                        image03.html("");
                    }
                    if (currentPage >= totalPage) {
                        var image04str = '<img src="/images/page/l-xyy-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image04str += ' <img src="/images/page/l-my-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image04.html(image04str);
                    } else {
                        image04.html("");
                    }
                } else {
                    $("#nodatadiv").show();
                    $("#showdiv").hide();
                }
                window.parent.document.getElementById('coverbehidepage').style.display = "none";
            },
            error: function (msg) {
                window.parent.document.getElementById('coverbehidepage').style.display = "none";
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                errormessagediv.style.color = "red";
            }

        })
        ;
    }


    function deleteLeave(leaveId) {
        window.location.href = "/person/deleteLeaveById?id=" + leaveId;
    }

    function updateLeave(leaveId) {
        window.location.href = "/person/toUpdateLeaveById?id=" + leaveId;
    }

    function showdeptNameByName(obj) {
        var formData = new FormData();
        formData.append('id', obj.value);
        $.ajax({
            data: formData,
            type: "POST",
            url: "/person/getDeptNameByEmployId",
            async: true,
            cache: false,
            contentType: false,
            processData: false,
            success: function (msg) {
                $(obj).parent().parent().find("td").eq(2).text(msg.substring(1, msg.length - 1));
            },
            error: function (msg) {
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                errormessagediv.style.color = "red";
            }

        });
    }

    var len;

    function checkIsNumA(obj) {
        $("#errormessage").hide();
        var reg = new RegExp("^[0-9]+(.[0-9]{1,3})?$");
        if (!reg.test(obj.value)) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;请输入数字!";
            errormessagediv.style.color = "red";
            obj.value = "0.0";
            return;
        }
    }


    function datedifference(sDate1, sDate2) {    //sDate1和sDate2是2006-12-18格式
        var dateSpan,
            tempDate,
            iDays;
        sDate1 = Date.parse(sDate1);
        sDate2 = Date.parse(sDate2);
        dateSpan = sDate2 - sDate1;
        dateSpan = Math.abs(dateSpan);
        iDays = Math.floor(dateSpan / (24 * 3600 * 1000));
        return iDays + 1;
    }

    function jisuanjiabanHours1(obj) {
        var leaveLong = 0;
        var objval = obj.value;
        if (objval.trim().length > 0) {
            var objval2 = $(obj).parent().parent().find("td").eq(4).find("input").eq(0).val();
            if (objval2.trim().length > 0) {
                var endLeaveStr = new Date(objval2);
                var splitA = objval2.split("T");
                var splitC = splitA[0].split(" ");
                var splitEndDate = splitC[0]
                var splitAA = objval.split("T");
                var splitCC = splitAA[0].split(" ");
                var splitBeginDate = splitCC[0]
                var beginLeaveStr = new Date(objval);
                var leaveLong = 0;
                if (endLeaveStr != null && beginLeaveStr != null) {
                    if (splitBeginDate == splitEndDate) {
                        var ms = endLeaveStr.getTime() - beginLeaveStr.getTime();
                        console.log(ms);
                        if (ms < 0) leaveLong = 0;
                        leaveLong = Math.floor(ms / 1000 / 60 / 60);
                        if (ms >= 32400000) {
                            leaveLong = leaveLong - 1;
                        }
                        if (!isNaN(leaveLong))
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(leaveLong);
                    } else {
                        var interDay = datedifference(splitBeginDate, splitEndDate);
                        var sampleBegin = new Date(splitBeginDate + " 08:30:00").getTime();
                        var sampleEnd = new Date(splitEndDate + " 17:30:00").getTime();
                        if (sampleBegin >= beginLeaveStr.getTime() && sampleEnd <= endLeaveStr.getTime()) {
                            leaveLong = interDay * 8;
                            if (!isNaN(leaveLong))
                                $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(leaveLong);
                        } else if (sampleBegin < beginLeaveStr.getTime() && sampleEnd > endLeaveStr.getTime()) {
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(interDay * 8);
                        } else if (sampleBegin < beginLeaveStr.getTime()) {
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(interDay * 8);
                        } else if (sampleEnd > endLeaveStr.getTime()) {
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(interDay * 8);
                        }

                    }
                }

                var weekJi = getWeekJiByDateA(objval.split(" ")[0]);
                if (weekJi == 1 || weekJi == 2 || weekJi == 3 || weekJi == 4 || weekJi == 5) {
                    $(obj).parent().parent().find("td").eq(6).find("select").eq(0).val(1);
                } else {
                    $(obj).parent().parent().find("td").eq(6).find("select").eq(0).val(2);
                }
            }

        }
    }

    function jisuanjiabanHours2(obj) {
        var leaveLong = 0;
        var objval2 = obj.value;
        if (objval2.trim().length > 0) {
            var objval = $(obj).parent().parent().find("td").eq(3).find("input").eq(0).val();
            if (objval.trim().length > 0) {
                var endLeaveStr = new Date(objval2);
                var splitA = objval2.split("T");
                var splitC = splitA[0].split(" ");
                var splitEndDate = splitC[0]
                var splitAA = objval.split("T");
                var splitCC = splitAA[0].split(" ");
                var splitBeginDate = splitCC[0]
                var beginLeaveStr = new Date(objval);
                var leaveLong = 0;
                if (endLeaveStr != null && beginLeaveStr != null) {
                    if (splitBeginDate == splitEndDate) {
                        var ms = endLeaveStr.getTime() - beginLeaveStr.getTime();
                        console.log(ms);
                        if (ms < 0) leaveLong = 0;
                        leaveLong = Math.floor(ms / 1000 / 60 / 60);
                        if (ms >= 32400000) {
                            leaveLong = leaveLong - 1;
                        }
                        if (!isNaN(leaveLong))
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(leaveLong);
                    } else {
                        var interDay = datedifference(splitBeginDate, splitEndDate);
                        var sampleBegin = new Date(splitBeginDate + " 08:30:00").getTime();
                        var sampleEnd = new Date(splitEndDate + " 17:30:00").getTime();
                        if (sampleBegin >= beginLeaveStr.getTime() && sampleEnd <= endLeaveStr.getTime()) {
                            leaveLong = interDay * 8;
                            if (!isNaN(leaveLong))
                                $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(leaveLong);
                        } else if (sampleBegin < beginLeaveStr.getTime() && sampleEnd > endLeaveStr.getTime()) {
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(interDay * 8);
                        } else if (sampleBegin < beginLeaveStr.getTime()) {
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(interDay * 8);
                        } else if (sampleEnd > endLeaveStr.getTime()) {
                            $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val(interDay * 8);
                        }

                    }
                }

                var weekJi = getWeekJiByDateA(objval.split(" ")[0]);
                if (weekJi == 1 || weekJi == 2 || weekJi == 3 || weekJi == 4 || weekJi == 5) {
                    $(obj).parent().parent().find("td").eq(6).find("select").eq(0).val(1);
                } else {
                    $(obj).parent().parent().find("td").eq(6).find("select").eq(0).val(2);
                }
            }

        }
    }

    function addJiaBanRow() {
        var empList = $("#empList1").val();
        var data = eval("(" + empList + ")");
        len = $("#tabletblody > tr").length;
        len++;
        var tbody = $("#tabletblody");
        var tr = $("<tr id='tr" + len + "'></tr>");
        tr.append("<td id='tr" + len + "'>" + len + "</td>");
        var td;
        td = "<td><select id=\"name\" onchange='showdeptNameByName(this)'  class=\"selectpicker show-tick form-control\"\n" +
            "   data-live-search=\"true\" data-actions-box=\"true\"\n" +
            "   data-selected-text-format=\"count > 1\">\n";
        for (var a = 0; a < data.length; a++) {
            td += "  <option value=\"" + data[a].id + "\">" + data[a].name + "</option>\n";
        }
        td += "  </select></td> ";

        tr.append(td);
        tr.append("<td></td>");
        tr.append("<td> <input type=\"text\" " +
            "               style=\"width:160px;height: 34px;text-align: center\" class=\"Wdate\" " +
            "  onchange='jisuanjiabanHours1(this)' id=\'startLeaveId\'" +
            "  onClick=\"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',maxDate:'#F{$dp.$D(\\'endLeaveId\\')}'})\"/></td>");
        tr.append("<td> <input type=\"text\" " +
            "               style=\"width:160px;height: 34px;text-align: center\" class=\"Wdate\" " +
            "  id=\'endLeaveId\' onchange='jisuanjiabanHours2(this)'" +
            " onClick=\"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',maxDate:'#F{$dp.$D(\\'startLeaveId\\')}'})\"/></td>");
        tr.append("<td><input type=\"text\"  class=\"form-control\" onblur='checkIsNumA(this)'  style=\"width:80px\"></td>");
        tr.append("<td><select ><option value='1'>平时加班</option>" +
            "<option value='2'>周末加班</option>" +
            "<option value='3'>法定假日加班</option>" +
            "</select></td>");
        tr.append("<td> <input type='text' placeholder='备注选填'></td>")
        tr.append("<td>   \n" +
            "    <a id=\"savebutton\"\n" +
            "    href=\"javascript:void(0);\" onclick=\"saveJiaBanDateToMysql(this)\">保存</a>" +
            " <a href=\"javascript:void(0);\"\n" +
            "    onclick=\"deleteTRA(this," + len + ");\">删除</a></td>");
        tr.appendTo(tbody);
        $('.selectpicker').selectpicker('refresh');
    }


    function deleteTRA(obj, len) {
        obj.parentElement.parentElement.remove();
        len--;
    }

    function saveJiaBanDateToMysql(obj) {
        $("#errormessage").hide();
        var formData = new FormData();
        formData.append("empId", $(obj).parent().parent().find("td").eq(1).find("select").eq(0).val());
        formData.append("type", $(obj).parent().parent().find("td").eq(6).find("select").eq(0).val());
        formData.append("remark", $(obj).parent().parent().find("td").eq(7).find("input").eq(0).val());
        formData.append("extDateFromStr", $(obj).parent().parent().find("td").eq(3).find("input").eq(0).val());
        formData.append("extDateEndStr", $(obj).parent().parent().find("td").eq(4).find("input").eq(0).val());
        formData.append("extWorkHours", $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val());

        $.ajax({
            data: formData,
            type: "POST",
            url: "/person/saveJiaBanDateToMysql",
            async: true,
            cache: false,
            contentType: false,
            processData: false,
            success: function (msg) {
                if (msg == 1) {
                    $("#errormessage").show();
                    var errormessagediv = document.getElementById("errormessage");
                    errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;保存成功!";
                    errormessagediv.style.color = "green";
                } else if (msg == 2) {
                    $("#errormessage").show();
                    var errormessagediv = document.getElementById("errormessage");
                    errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;已存在加班单!";
                    errormessagediv.style.color = "red";
                }
            },
            error: function (msg) {
                $("#errormessagee").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                errormessagediv.style.color = "red";
            }

        });
    }

    function getWeekJiByDateA(KingVal) {
        var DateYear = parseInt(KingVal.split("-")[0]);
        var DateMonth = parseInt(KingVal.split("-")[1]);
        var DateDay = parseInt(KingVal.split("-")[2]);
        var NewDate = new Date(DateYear, DateMonth - 1, DateDay);
        return NewDate.getDay();
    }

    function deleteJiaBanDateToMysql(id) {
        window.location.href = "/person/deleteJiaBanDateToMysql?id=" + id;
    }
</script>
<body>

<div id='app'>
    <form>
        <input type="hidden" id="flag" th:value="${flag}">
        <input type="hidden" id="maxPage" th:value="${jiaBan.maxPage}">
        <input type="hidden" id="n_currentPage" th:value="${jiaBan.currentPage}"/>
        <input type="hidden" id="empList1" th:value="${empList1}"/>

        <ul id="myTab" class="nav nav-tabs">
            <li>
                <a th:href="@{/person/toleavepage}">请假单</a>
            </li>
            <li>
                <a th:href="@{/person/toqiankadan}">签卡单</a>
            </li>
            <li>
                <a th:href="@{/person/tolianbandan}">连班单</a>
            </li>
            <li class="active">
                <a href="#compreAttendRecord" data-toggle="tab">加班申请单</a>
            </li>
            <li>
                <a th:href="@{/person/tonightworkdan}">夜班申请</a>
            </li>
            <li>
                <a th:href="@{/person/tooutdan}">员工外出单</a>
            </li>
            <li>
                <a th:href="@{/person/tolinshidan}">临时工工时单</a>
            </li>
            <li>
                <a th:href="@{/person/totiaoxiu}">调休单</a>
            </li>
        </ul>
        <br>
        <p>
        <div id="compreAttendRecord">
            <div class="panel panel-primary">
                <div class="panel-body form-inline">
                    <table>
                        <tr>
                            <td style="text-align: right">
                                <label>姓名：</label>
                            </td>
                            <td>
                                <select id="name" multiple class="selectpicker show-tick form-control"
                                        data-live-search="true" data-actions-box="true"
                                        data-selected-text-format="count > 2">
                                    　　
                                    <option th:each="c:${empList}" th:value="${c.id}"
                                            th:text="${c.name}"></option>
                                </select>
                            </td>

                            <td style="text-align: right">
                                <label>工号：</label>
                            </td>
                            <td>
                                <label><input type="text" id="empNo" class="form-control" style="width:150px"></label>
                            </td>

                            <td style="text-align: right">
                                <label>部门：</label>
                            </td>
                            <td>
                                <select id="deptId" multiple class="selectpicker show-tick form-control"
                                        data-live-search="true" data-actions-box="true"
                                        data-selected-text-format="count > 2">
                                    　　
                                    <option th:each="c:${deptList}" th:value="${c.id}"
                                            th:text="${c.deptname}"></option>
                                </select>
                            </td>

                            <td style="text-align: right">
                                <label>职位：</label>
                            </td>
                            <td>
                                <select id="positionId" multiple class="selectpicker show-tick form-control"
                                        data-live-search="true" data-actions-box="true"
                                        data-selected-text-format="count > 2">
                                    　　
                                    <option th:each="c:${positionList}" th:value="${c.id}"
                                            th:text="${c.positionName}"></option>
                                </select>
                            </td>
                            <td><label>加班类型：</label></td>
                            <td>
                                <select id="leaveType" multiple class="selectpicker show-tick form-control"
                                        data-live-search="true" data-actions-box="true"
                                        data-selected-text-format="count > 1">　
                                    <option value="1">平常加班</option>
                                    <option value="2">周末加班</option>
                                    <option value="3">法定假日加班</option>
                                </select>

                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>加班时间起：</label>
                            </td>
                            <td>
                                <input type="text" id="startLeaveId"
                                       style="width:130px;height: 34px;text-align: center"
                                       class="Wdate"
                                       onclick="WdatePicker({dateFmt:'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'endLeaveId\')}'})"/>

                            </td>
                            <td>
                                <label>加班时间止：</label>
                            </td>
                            <td>
                                <input type="text" id="endLeaveId"
                                       style="width:140px;height: 34px;text-align: center" class="Wdate"
                                       onclick="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'#F{$dp.$D(\'startLeaveId\')}'})"/>

                            </td>
                            <td style="text-align: right" colspan="3">
                                <a class="btn btn-primary"
                                   href="javascript:void(0);" onclick="queryJBByCondition()">查找</a>
                                &nbsp;&nbsp;&nbsp;
                                <a class="btn btn-primary"
                                   href="javascript:void(0);"
                                   onclick="addJiaBanRow()">新增</a>
                            </td>
                            <td>
                                <div style="display: none" id="errormessage">

                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
    </form>
    <table class="table table-bordered table-hover table-striped text-center" id="showlistbody">
        <thead style="background-color:lightsteelblue">
        <tr>
            <th style="text-align: center">序号</th>
            <th style="text-align: center">姓名</th>
            <th style="text-align: center">部门</th>
            <th style="text-align: center">加班时间起</th>
            <th style="text-align: center">加班时间止</th>
            <th style="text-align: center">加班工时</th>
            <th style="text-align: center">加班类型</th>
            <th style="text-align: center">备注</th>
            <th style="text-align: center">操作</th>
        </tr>
        </thead>
        <tbody id="tabletblody">
        <!--v-for中的数据不再是直接从data中获取，而是通过search方法对data中的数据进行过滤再显示-->
        <div th:unless="${#lists.isEmpty(jiaBanList)}">
            <div th:each="leavea ,iterStat: ${jiaBanList}" align="center">
                <tr>
                    <td align="center"
                        th:text="${(iterStat.index+1)}+${jiaBan.currentPage-1}*${jiaBan.pageSize}"></td>
                    <td align="center" th:text="${leavea.name}"></td>
                    <td align="center" th:text="${leavea.deptName}"></td>
                    <td align="center" th:text="${leavea.extDateFromStr}"></td>
                    <td align="center" th:text="${leavea.extDateEndStr}"></td>
                    <td align="center" th:text="${leavea.extWorkHours}"></td>
                    <td align="center" th:text="${leavea.typeStr}"></td>
                    <td align="center" th:text="${leavea.remark}"></td>
                    <td align="center">
                        <a href="javascript:void(0);"
                           th:onclick="saveJiaBanDateToMysql(this);">保存</a>
                        <a href="javascript:void(0);"
                           th:onclick="deleteJiaBanDateToMysql([[${leavea.id}]]);">删除</a>
                    </td>
                </tr>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(jiaBanList)}">
            <tr>
                <td align="center" colspan="9">查无数据</td>
            </tr>
        </div>
        </tbody>

        <tfoot id="s_tfoot">
        <tr id="showdiv">

            <td colspan="9" align="center">
                <span>第</span>
                <span th:text="${jiaBan.currentPage}" id="currentpagespan"> </span>
                <span>页|共</span>
                <span th:text="${jiaBan.maxPage}" id="maxpagespan"> </span>
                <span>页|共</span>
                <span th:text="${jiaBan.recordCount}" id="recordcountspan"> </span>
                <span>条记录 </span>
                <span id="image01">
                            <span th:if="${jiaBan.currentPage gt 1}">
                                    <img src="/images/page/sy-2.jpg" align="middle" border="0"
                                         style="width: 20px; height: 20px; vertical-align: middle"
                                         onClick="goPageone()"/>
                                    <img src="/images/page/syy-2.jpg" align="middle" border="0" onClick="goPrePage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;

                                </span>
                                </span>
                <span id="image02">
                            <span th:if="${jiaBan.currentPage le 1}">
                                <img src='/images/page/l-sy-2.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                                <img src='images/images/page/l-syy-2.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;
                            </span>
                            </span>
                <span id="image03">
                            <span th:if="${jiaBan.currentPage lt jiaBan.maxPage}">
                                    <img src="/images/page/xyy-2.jpg" align="middle" border="0" onClick="goAftPage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>
                                    <img src="/images/page/my-2.jpg" align="middle" border="0" onClick="goMaxPage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>
                            </span>
                                </span>
                <span id="image04">
                            <span th:if="${jiaBan.currentPage ge jiaBan.maxPage}">
                                <img src='/images/page/l-xyy-1.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                                <img src='/images/page/l-my-1.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                            </span>
                            </span>

                |&nbsp;到第
                <input onkeypress="if(event.keyCode==13) {gopage.click();return false;}"
                       style="width: 50px"
                       id="_tp" th:name="currentPage" type="text" th:value="${jiaBan.currentPage}"/>
                页&nbsp;
                <img src="/images/page/cx-2.jpg" id="gopage" onClick="goPage2()"
                     style="width:20px;height:20px;vertical-align:middle">
            </td>

        </tr>


        <tr style="display:none;" id="nodatadiv">
            <td colspan="9" align="center">
                查无数据
            </td>
        </tr>
        </tfoot>
    </table>
</div>
</div>
</body>
</html>