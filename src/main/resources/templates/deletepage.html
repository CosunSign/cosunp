<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>设计文件</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="audownloadFileOrFolderForZipthor" content="">
    <script src="/lib/jquery-3.3.1.min.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" th:href="@{/lib/bootstrap/css/bootstrap.css}">
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/theme.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/premium.css">
    <script src="/lib/WdatePicker.js" type="text/javascript"></script>
</head>

<body class=" theme-blue">

<script src="/lib/bootstrap/js/bootstrap.js"></script>
<script type="text/javascript">
    $("[rel=tooltip]").tooltip();
    $(function () {
        $('[data-popover="true"]').popover({html: true});
        $('.demo-cancel-click').click(function () {
            return false;
        });
    });
</script>

<script src="//open.thunderurl.com/thunder-link.js"></script>
<script type="text/javascript">
    var extensionarrays;
    var extensionarray;
    $(function () {
        extensionarrays = $("#extension").val();
        extensionarray = eval("(" + extensionarrays + ")");
        window.parent.document.getElementById('content').style.display = "block";
        window.parent.document.getElementById('contentnew').style.display = "none";
        var flag = $("#flag").val();
        if (flag == "-1") {
            alert("您单次要删除的文件已超过2G!不能超过2G");
        } else if (flag == "-2") {
            alert("您单次要删除的文件个数已超过200个,不能超过200个.");
        } else if (flag == "-369") {
            //$("#some-element").busyLoad("hide");//遮罩层关闭
            window.parent.document.getElementById('coverbehidepage').style.display = "none";

        } else if (flag == "-258") {
            alert("您要删除的文件没有权限,可联系上级帮你申请!")
        }
        var match = document.cookie.match(new RegExp('color=([^;]+)'));
        if (match) var color = match[1];
        if (color) {
            $('body').removeClass(function (index, css) {
                return (css.match(/\btheme-\S+/g) || []).join(' ')
            })
            $('body').addClass('theme-' + color);
        }
    });


</script>
<style type="text/css">
    .clear {
        zoom: 1;
    }

    #showMessageDiv {
        border: 1px solid #9AC0CD;
        width: 800px;
        height: 500px;
        Margin: 2px;
        padding: 3px;
        z-index: 1007;
        background-color: #E0EEEE;
        position: absolute;
        top: 19%;
        left: 28%;;
    }

    #innershowMessageDiv {
        border: 1px solid #9AC0CD;
        width: 787px;
        height: 487px;
        Margin: 3px;
        padding: 3px;
        z-index: 1008;
        background-color: #E0EEEE;
        position: absolute;
    }

    #innershowMessageDiv1 {
        border: 1px solid #9AC0CD;
        width: 750px;
        height: 390px;
        margin-left: 15px;
        margin-right: 15px;
        margin-top: 15px;
        padding: 3px;
        background-color: #E0EEEE;
    }

    #innershowMessageDiv11 {
        width: 745px;
        height: 30px;
        background-color: #E0EEEE;
    }

    #innershowMessageDiv12 {
        width: 745px;
        height: 360px;
        background-color: #E0EEEE;
        position: absolute;
    }


    #innershowMessageDiv2 {
        border: 1px solid #9AC0CD;
        width: 750px;
        height: 50px;
        margin-left: 15px;
        margin-right: 15px;
        margin-bottom: 15px;
        padding-left: 3px;
        padding-right: 3px;
        padding-bottom: 3px;
        background-color: #E0EEEE;
        position: absolute;

    }

    .clear:after {
        content: "";
        display: block;
        height: 0;
        clear: both;
        visibility: hidden;
    }

    .page_btn {
        padding-top: 20px;
    }

    .page_btn a {
        cursor: pointer;
        padding: 1px;
        border: solid 1px #ccc;
        font-size: 12px;
    }

    .page_box {
        float: right;
    }

    .num {
        padding: 0 10px;
    }

    #folderdiv {
        border: 1px solid #9AC0CD;
        width: 98%;
        height: 550px;
        Margin: 2px;
        padding: 3px;
    }

    #innerfolderdiv {
        border: 1px solid #9AC0CD;
        width: 98%;
        height: 495px;
        Margin: 10px;
        padding: 3px;
    }

    .navbar-default .navbar-brand, .navbar-default .navbar-brand:hover {
        color: #fff;
    }
</style>
<script type="text/javascript">
    $(function () {
        var uls = $('.sidebar-nav > ul > *').clone();
        uls.addClass('visible-xs');
        $('#main-menu').append(uls.clone());

        $(".next").click(function () {
            if (current_num >= total_page) {
                return false;
            } else {
                $(".current_page").text(++current_num);
                $.each($('#showdatatable li'), function (index, item) {
                    var start = current_page * (current_num - 1);
                    var end = current_page * current_num;
                    if (index >= start && index < end) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }
        });

        $(".prev").click(function () {
            if (current_num == 1) {
                return false;
            } else {
                $(".current_page").text(--current_num);
                $.each($('#showdatatable li'), function (index, item) {
                    var start = current_page * (current_num - 1);
                    var end = current_page * current_num;
                    if (index >= start && index < end) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }
        })

    });

    var currentPage;
    var totalPage;
    var totaldata;
    var pageSize;
    var username;
    var password;

    var current_page = 15;
    var current_num = 1;
    var total_page;
    var fileDownloadCheckTimer;

    function blockUIForDownload() {
        var token = "111";
        $('#download_token_value_id').val(token);
        fileDownloadCheckTimer = window.setInterval(function () {
            var cookieValue = getCookie('ccc');
            if (cookieValue == token) {
                window.parent.document.getElementById('coverbehidepage').style.display = "none";
                finishDownload();
            }
        }, 1000);
    }

    function alertMessageDiv() {
        var ojb = window.parent.document.getElementById('innershowMessageDiv12');
        ojb.innerHTML = "<p>\n" +
            "                    <font color=\"#000000\" size=\"2\" th:align=\"center\">一,您得需要有您准备删除的文件(夹)的删除权限.</font>\n" +
            "  <p>\n" +
            "                    <font color=\"#000000\" size=\"2\" th:align=\"center\">二,本删除功能为物理删除，一旦执行删除操作，永不恢复。请谨慎操作.</font>\n";
        window.parent.document.getElementById('coverbehidepage').style.display = "block";
        window.parent.document.getElementById('showMessageDiv').style.display = "block";
    }

    function closeShowMessage() {
        window.parent.document.getElementById('coverbehidepage').style.display = "none";
    }


    function getCookie(cookie_name) {
        var allcookies = document.cookie;
        var cookie_pos = allcookies.indexOf(cookie_name);
        if (cookie_pos != -1) {
            cookie_pos = cookie_pos + cookie_name.length + 1;
            var cookie_end = allcookies.indexOf(";", cookie_pos);

            if (cookie_end == -1) {
                cookie_end = allcookies.length;

            }
            var value = unescape(allcookies.substring(cookie_pos, cookie_end));
        }
        return value;
    }

    function finishDownload() {
        window.clearInterval(fileDownloadCheckTimer);
        delCookie('ccc');
    }

    function delCookie(name) {
        var exp = new Date();
        exp.setTime(exp.getTime() - 1);
        var cval = getCookie(name);
        if (cval != null) {
            document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString();
        }
    }

    var topfolder;

    function backFolder3() {
        var foldername = $("#foldername").val();
        var reg = new RegExp(/^[A-Z]{5}[0-9]{8}[A-Z]{2}[0-9]{2}$/g);
        var salor = $("#salor").val();
        var engineer = $("#engineer").val();
        var orderNo = $("#orderno").val().trim();
        var fileInput = $('#file').val();
        var folderhtml = "";
        var fileshtml = "";
        var cominone2 = 0;
        if (orderNo == "" || orderNo == null) {
            alert("点击返回的时候，订单编号不能为空！请不要删空它。")
            return;
        }
        //$("#some-element").busyLoad("show");//遮罩层开启
        window.parent.document.getElementById('coverbehidepage').style.display = "block";

        var jsonarray = {
            "salor": salor, //业务员
            "engineer": engineer, //设计师
            "orderNo": orderNo, //订单编号
            "folderName": foldername//当前文件夹名
        };
        var data = JSON.stringify(jsonarray);
        $.ajax({
            data: data,
            type: "POST",
            contentType: "application/json",//上传内容格式为json结构
            url: "/fileupdown/findBackFoldersByQueryParam3",
            success: function (msg) {
                var data = eval(msg);
                var totalnum = data.length;
                $.each(data, function (num) {
                    var ind = data[num].lastIndexOf('.');
                    var extenName = data[num].substr(ind + 1, data[num].length);
                    if (num < totalnum - 1 && totalnum > 1) {
                        if (num < 15) {
                            if (data[num].indexOf(".") <= 0 || !extensionarray.includes(extenName.toLowerCase())) {
                                $("#foldername").val(data[num]);
                                if (reg.test(data[num])) {
                                    $("#backfolder").attr("disabled", "disabled");
                                }
                                folderhtml += "<li><input   type=\"checkbox\"   th:value=\"" + data[num] + "\" id='" + data[num] + "' name=\"downloadlist\">" +
                                    " <img src=\"/images/icon/Folder.png\" " +
                                    " align=\"middle\" border=\"0\" value='" + data[num] + "' ondblclick=\"shownextfolderorfiles(this)\"\n" +
                                    " style=\"width: 30px; height: 30px; vertical-align: middle\"/>" + data[num] + "</li>";
                                cominone2 = 1;
                            } else {
                                if (extensionarray.includes(extenName.toLowerCase())) {
                                    fileshtml += "<li><input type=\"checkbox\" value='" + data[num] + "' id='" + data[num] + "' name=\"downloadlist\">" +
                                        "<img src=\"/images/icon/File.png\" align=\"middle\" border=\"0\"  style=\"width: 30px; height: 30px; vertical-align: middle\"/>"
                                        + data[num] + "</li>";
                                    if (cominone2 == 0) {
                                        $("#foldername").val(data[num]);
                                    }
                                }
                            }
                        } else {
                            if (data[num].indexOf(".") <= 0 || !extensionarray.includes(extenName.toLowerCase())) {
                                $("#foldername").val(data[num]);
                                if (reg.test(data[num])) {
                                    $("#backfolder").attr("disabled", "disabled");
                                }
                                folderhtml += "<li style='display: none;'><input   type=\"checkbox\"   th:value=\"" + data[num] + "\" id='" + data[num] + "' name=\"downloadlist\">" +
                                    " <img src=\"/images/icon/Folder.png\" " +
                                    " align=\"middle\" border=\"0\" value='" + data[num] + "' ondblclick=\"shownextfolderorfiles(this)\"\n" +
                                    " style=\"width: 30px; height: 30px; vertical-align: middle\"/>" + data[num] + "</li>";
                                cominone2 = 1;
                            } else {
                                if (extensionarray.includes(extenName.toLowerCase())) {
                                    fileshtml += "<li style='display: none;'><input type=\"checkbox\" value='" + data[num] + "' id='" + data[num] + "' name=\"downloadlist\">" +
                                        "<img src=\"/images/icon/File.png\" align=\"middle\" border=\"0\"  style=\"width: 30px; height: 30px; vertical-align: middle\"/>" +
                                        data[num] + "</li>";
                                    if (cominone2 == 0) {
                                        $("#foldername").val(data[num]);
                                    }
                                }
                            }
                        }

                    }
                });
                $("#showdatatable").html(folderhtml + fileshtml)
                var maxPages = Math.round((totalnum + 15 - 1) / 15);

                var next = $(".next");
                var prev = $(".prev");
                $(".total").text(maxPages);
                $(".current_page").text(1);
                $("#n_currentPage").val(1)
                total_page = maxPages;
                $("#_tp").val(1);
                $("#currentpagespan").val(1)
                $("#nodatadiv").hide();
                $("#pagetfoottr").show();
                $("#showdiv").hide();

                if (reg.test(data[totalnum])) {
                    $("#orderno").val(data[totalnum]);
                }
            },
            error: function (msg) {
                //$("#some-element").busyLoad("hide");
                window.parent.document.getElementById('coverbehidepage').style.display = "none";

                alert("查询失败");
            }
        });

        // $("#some-element").busyLoad("hide");//遮罩层开启
        window.parent.document.getElementById('coverbehidepage').style.display = "none";

    }

    function shownextfolderorfiles(foldernam) {
        var foldername = foldernam.getAttribute("value");
        var reg = new RegExp(/^[A-Z]{5}[0-9]{8}[A-Z]{2}[0-9]{2}$/g);
        $("#backfolder").removeAttr("disabled");
        var salor = $("#salor").val();
        var engineer = $("#engineer").val();
        var orderNo = $("#orderno").val().trim();
        if (orderNo == "") {
            if (reg.test(foldername)) {
                orderNo = foldername;
            }
        }
        if (orderNo == "") {
            alert("进行点击文件夹操作,请不要删除输入框的订单编号!");
            return;
        }

        var folderhtml = "";
        var fileshtml = "";
        var cominone = 0;
        //$("#some-element").busyLoad("show");//遮罩层开启
        window.parent.document.getElementById('coverbehidepage').style.display = "block";

        var jsonarray = {
            "salor": salor, //业务员
            "engineer": engineer, //设计师
            "orderNo": orderNo, //订单编号
            "folderName": foldername//当前文件夹名
        };
        var data = JSON.stringify(jsonarray);
        $.ajax({
            data: data,
            type: "POST",
            contentType: "application/json",//上传内容格式为json结构
            url: "/fileupdown/findNextFoldersByQueryParam2",
            success: function (msg) {
                var data = eval(msg);
                var totalnum = data.length;
                $.each(data, function (num) {
                    var ind = data[num].lastIndexOf('.');
                    var extenName = data[num].substr(ind + 1, data[num].length);
                    if (num < totalnum - 1 && totalnum > 1) {
                        if (num < 15) {
                            if (data[num].indexOf(".") <= 0 || !extensionarray.includes(extenName.toLowerCase())) {
                                $("#foldername").val(data[num]);

                                folderhtml += "<li ><input type=\"checkbox\" value='" + data[num] + "' id='" + data[num] + "' name=\"downloadlist\">" +
                                    " <img src=\"/images/icon/Folder.png\" " +
                                    " align=\"middle\" border=\"0\" value='" + data[num] + "' ondblclick=\"shownextfolderorfiles(this)\"\n" +
                                    " style=\"width: 30px; height: 30px; vertical-align: middle\"/>" + data[num] + "</li>";
                                cominone = 1;

                            } else {
                                if (extensionarray.includes(extenName.toLowerCase())) {
                                    fileshtml += "<li><input type=\"checkbox\" value='" + data[num] + "' id='" + data[num] + "' name=\"downloadlist\">"
                                        + "<img src=\"/images/icon/File.png\" align=\"middle\" border=\"0\"  style=\"width: 30px; height: 30px; vertical-align: middle\"/>"
                                        + data[num] + "</li>";
                                    if (cominone == 0) {
                                        $("#foldername").val(data[num]);
                                    }
                                }
                            }
                        } else {
                            if (data[num].indexOf(".") <= 0 || !extensionarray.includes(extenName.toLowerCase())) {
                                $("#foldername").val(data[num]);

                                folderhtml += "<li style=\"display:none\"><input type=\"checkbox\" value='" + data[num] + "' id='" + data[num] + "' name=\"downloadlist\">" +
                                    " <img src=\"/images/icon/Folder.png\" " +
                                    " align=\"middle\" border=\"0\" value='" + data[num] + "' ondblclick=\"shownextfolderorfiles(this)\"\n" +
                                    " style=\"width: 30px; height: 30px; vertical-align: middle\"/>" + data[num] + "</li>";
                                cominone = 1;

                            } else {
                                if (extensionarray.includes(extenName.toLowerCase())) {
                                    fileshtml += "<li style=\"display:none\"><input type=\"checkbox\" value='" + data[num] + "' id='" + data[num] + "' name=\"downloadlist\">"
                                        + "<img src=\"/images/icon/File.png\" align=\"middle\" border=\"0\"  style=\"width: 30px; height: 30px; vertical-align: middle\"/>"
                                        + data[num] + "</li>";
                                    if (cominone == 0) {
                                        $("#foldername").val(data[num]);
                                    }
                                }
                            }
                        }


                    } else if (num == totalnum - 1) {
                        $("#orderno").val(data[num]);


                        var maxPages = Math.round((totalnum + 15 - 1) / 15);

                        var next = $(".next");//下一页
                        var prev = $(".prev");//上一页
                        $(".total").text(maxPages);//显示总页数
                        $(".current_page").text(1);//当前的页数
                        $("#n_currentPage").val(1)
                        total_page = maxPages;//最大页数
                        $("#_tp").val(1);
                        $("#currentpagespan").val(1)

                    }
                });
                //$("#innerfolderdiv").html(folderhtml + fileshtml)
                $("#showdatatable").html(folderhtml + fileshtml)
                $("#nodatadiv").hide();
                $("#pagetfoottr").show();
                $("#showdiv").hide();
            },
            error: function (msg) {
                //$("#some-element").busyLoad("hide");
                window.parent.document.getElementById('coverbehidepage').style.display = "none";

                alert("查询失败");
            }
        });

        // $("#some-element").busyLoad("hide");//遮罩层开启
        window.parent.document.getElementById('coverbehidepage').style.display = "none";


    }


    var currentPage; //当前页
    var totalPage; //总多少页
    var totaldata; //总共多少记录
    var pageSize;//当前每页多少条

    function submitQueryByCondition() {
        $("#pagetfoottr").hide();
        var reg = new RegExp(/^[A-Z]{5}[0-9]{8}[A-Z]{2}[0-9]{2}$/g);
        var folderhtml = "";
        var fileshtml = "";
        var cominone2 = 0;
        // $("#some-element").busyLoad("show");//遮罩层开启
        window.parent.document.getElementById('coverbehidepage').style.display = "block";
        var jsonarray = {
            "salor": $("#salor").val(), //业务员
            "engineer": $("#engineer").val(),//设计师
            "orderNo": $("#orderno").val(), //订单编号
            "projectName": $("#projectname").val(), //项目编号
            "fileName": $("#filename").val(), //文件名
            "startNewestSaveDateStr": $("#startnewestsavedate").val(), //查询开始时间
            "endNewestSaveDateStr": $("#endnewestsavedate").val(), //查询结束时间
            "currentPage": $("#n_currentPage").val()
        };
        var data = JSON.stringify(jsonarray);
        $.ajax({
            data: data,
            type: "POST",
            contentType: "application/json",//上传内容格式为json结构
            url: "/fileupdown/deletebyquerycondition",
            success: function (msg) {
                var data = eval(msg);
                var image01 = $("#image01");
                var image02 = $("#image02");
                var image03 = $("#image03");
                var image04 = $("#image04");
                var maxpageid = $("#maxPage");
                var n_currentPage = $("#n_currentPage");
                var inputpage = $("#_tp");
                image01.html("");
                image02.html("");
                image03.html("");
                image04.html("");
                var tbody = $("#showdatatable");
                var tfoot = $("#s_tfoot");
                tbody.html("");
                if (data != null) {
                    if (data.length > 0) {
                        $("#nodatadiv").hide();
                        $("#showdiv").show();
                        currentPage = data[0].currentPage; //当前页
                        totalPage = data[0].maxPage; //总多少页
                        totaldata = data[0].recordCount; //总共多少记录
                        username = data[0].userName;
                        password = data[0].userPwd;
                        pageSize = data[0].pageSize;
                        maxpageid.val(totalPage);
                        n_currentPage.val(currentPage);
                        inputpage.val(currentPage);
                        $.each(data, function (num) {
                            if (data[num].orderNo.indexOf(".") <= 0) {
                                $("#foldername").val(data[num].orderNo);
                                if (reg.test(data[num].orderNo)) {
                                    $("#backfolder").attr("disabled", "disabled");
                                }
                                folderhtml += "<li><input type=\"checkbox\" value=" + data[num].orderNo + " id='" + data[num].orderNo + "' name=\"downloadlist\"><img src=\"/images/icon/Folder.png\" " +
                                    " align=\"middle\" border=\"0\"  value=" + data[num].orderNo + " ondblclick=\"shownextfolderorfiles(this)\"\n" +
                                    " style=\"width: 30px; height: 30px; vertical-align: middle\"/>" + data[num].orderNo + "</li>";
                                cominone2 = 1;
                            } else {
                                fileshtml += "<li><input type=\"checkbox\" value='" + data[num].orderNo + "' id='" + data[num].orderNo + "'  name=\"downloadlist\">"
                                    + "<img src=\"/images/icon/File.png\" align=\"middle\" border=\"0\"  style=\"width: 30px; height: 30px; vertical-align: middle\"/>"
                                    + data[num].orderNo + "</li>";
                                if (cominone2 == 0) {
                                    $("#foldername").val(data[num].orderNo);
                                }
                            }
                        });
                        $("#showdatatable").html(folderhtml + fileshtml)
                        $("#currentpagespan").html(currentPage);
                        $("#maxpagespan").html(totalPage);
                        $("#recordcountspan").html(totaldata);


                        if (currentPage > 1) {
                            var imange01str = '<img src="/images/page/sy-2.jpg"  onClick="goPageone()"  align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                            imange01str += '<img src="/images/page/syy-2.jpg" onClick="goPrePage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                            image01.html(imange01str);
                        } else {
                            image01.html("");
                        }
                        if (currentPage <= 1) {
                            var image02str = '<img src="/images/page/l-sy-2.jpg" align="middle" border="0px"';
                            image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                            image02str += ' <img src="/images/page/l-syy-2.jpg" align="middle" border="0px"';
                            image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                            image02.html(image02str);
                        } else {
                            image02.html("");
                        }
                        if (currentPage < totalPage) {
                            var imange03str = '<img src="/images/page/xyy-2.jpg" onClick="goAftPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                            imange03str += '<img src="/images/page/my-2.jpg" onClick="goMaxPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                            image03.html(imange03str);
                        } else {
                            image03.html("");
                        }
                        if (currentPage >= totalPage) {
                            var image04str = '<img src="/images/page/l-xyy-1.jpg" align="middle" border="0px"';
                            image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                            image04str += ' <img src="/images/page/l-my-1.jpg" align="middle" border="0px"';
                            image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                            image04.html(image04str);
                        } else {
                            image04.html("");
                        }
                    }
                } else {
                    $("#nodatadiv").show();
                    $("#showdiv").hide();
                    $("#currentpagespan").html(0);
                    $("#maxpagespan").html(0);
                    $("#recordcountspan").html(0);
                    $("#_tp").val(0)
                }
            },
            error: function (msg) {
                // 隐藏loading
                //$("#some-element").busyLoad("hide");
                window.parent.document.getElementById('coverbehidepage').style.display = "none";

                alert("失败");
            }

        });
        //$("#some-element").busyLoad("hide");//遮罩层开启
        window.parent.document.getElementById('coverbehidepage').style.display = "none";

    }


    function exportDataByCondition() {
        alert("此功能暂未做")
    }


    function goPageone() {
        $("#n_currentPage").val(1);
        submitQueryByCondition();
    }

    function goPrePage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 - 1 * 1);
        submitQueryByCondition();
    }

    function goAftPage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 + 1 * 1);
        submitQueryByCondition();
    }

    function showcookie() {
        window.location.href = "/fileupdown/showcookies";
    }

    function goMaxPage() {


        $("#n_currentPage").val($("#maxPage").val());
        submitQueryByCondition();
    }

    function goPage2() {
        var tp = document.getElementById("_tp").value;//currentPage
        var max = $("#maxPage").val(); //maxPage
        tp = tp.trim();
        var r = /^\+?[0-9][0-9]*$/;
        if (!(r.test(tp))) {
            alert("页数输入有误，请重新输入!");
            $("#_tp").val(max);
            return false;
        } else if (parseInt(tp) == 0) {
            alert("页数必须大于0!");
            $("#_tp").val(max);
            return false;
        } else if (parseInt(tp) > parseInt(max)) {
            alert("不能大于总页数!");
            $("#_tp").val(max);
            return false;
        } else {
            $("#n_currentPage").val(tp);
            // document.forms["form0"].submit();
            submitQueryByCondition();
        }
    }

    function goAjaxPage(strCount) {
        switch (strCount) {
            case "0":
                if (currentPage == 1)
                    return;
                else
                    currentPage = 1;
                break;
            case "-1":
                if (currentPage == 1)
                    return;
                if (currentPage != 1)
                    currentPage = parseInt(currentPage) - 1;
                break;
            case "1":
                if (currentPage == totalPage)
                    return;
                if (currentPage != totalPage)
                    currentPage = parseInt(currentPage) + 1;
                break;
            case "end":
                if (currentPage == totalPage)
                    return;
                if (currentPage != totalPage)
                    currentPage = totalPage;
                break;
            case "_go":
                var _page = $("#_tp2").val();
                if (!isInt(_page)) {
                    alert("请输入正整数!");
                    return;
                }
                if (_page <= 0) {
                    alert("页数必须大于0!");
                    return;
                }
                if (parseInt(_page) > parseInt(totalPage)) {
                    alert("不能大于总页数!");
                    return;
                }
                currentPage = $("#_tp2").val();
                break;

            default:
                break;
        }
        if (totalPage) {
            $("#n_currentPage").val(currentPage);
            querySupplierPage();
        }
    }

    function clickButton(event) {
        if (event.keyCode == 13) {
            goAjaxPage("_go");
            return false;
        }
    }

    function isNull(arg1) {
        if (arg1 == "null" || arg1 == null) {
            return "";
        }
        return arg1;
    }

    function isInt(str) {
        var re = /^[0-9]*[1-9][0-9]*$/;
        return re.test(str);
    }

    function subUrlFileName(str) {
        var result = str.split("/");
        var len = result.length;
        return result[len - 1];
    }


    function deleteBySelect() {

        var reg1 = new RegExp(/^[A-Z]{5}[0-9]{8}[A-Z]{2}[0-9]{2}$/g)
        var obj = document.getElementsByName("downloadlist");
        var checkval = [];
        var isChecked = 0;
        var orderNo = "";
        for (k in obj) {
            var value = {orderNo: '', folderOrFileName: ''};
            if (obj[k].checked) {
                if (reg1.test(obj[k].id)) {
                    reg1 = new RegExp(/^[A-Z]{5}[0-9]{8}[A-Z]{2}[0-9]{2}$/g)
                    orderNo = obj[k].id;
                    value["orderNo"] = orderNo;
                } else {
                    orderNo = $("#orderno").val();
                    value["orderNo"] = orderNo;
                }
                value["folderOrFileName"] = obj[k].value;
                checkval.push(value);
                isChecked = 1;
            }
        }
        if (isChecked == 0) {
            alert("请先勾选您要删除的文件或文件夹!");
            return false;
        }

        var isDeleteConfirm = confirm("确定要删除?删除后将无法撤销!");
        if (isDeleteConfirm) {
            var orderno = $("#orderno").val();
            //$("#coverbehidepage").show();
            window.parent.document.getElementById('coverbehidepage').style.display = "block";
            //window.location.href="/fileupdown/downloadfileorfolderforzip?orderno="+orderno+"&check_val="+check_val;
            var jsonarray = {
                "orderNo": orderno, //订单编号
                "check_val": checkval
            };
            var data = JSON.stringify(checkval);
            var urlstrArr = [];
            window.parent.document.getElementById('coverbehidepage').style.display = "block";
            $.ajax({
                data: data,
                type: "POST",
                contentType: "application/json",//上传内容格式为json结构
                url: "/fileupdown/deleteFileBySelect",
                success: function (msg) {
                    if (msg == '"-1"') {
                        alert("您要删除的文件已超过2G！严禁删除。");
                        return false;
                    }
                    if (msg == '"-369"') {
                        alert("您要删除的文件已超过200个，请重新选择!");
                        return false;
                    }
                    if (msg == '"-258"') {
                        alert("您要删除的文件没有删除权限，请向上级申请!")
                        return false;
                    }
                    if (msg == '"OK"') {
                        alert("删除成功！")
                        submitQueryByCondition();
                    }
                },
                error: function (msg) {
                    // $("#some-element").busyLoad("hide");
                    window.parent.document.getElementById('coverbehidepage').style.display = "none";
                    alert("删除失败");
                }
            });
            //$("#coverbehidepage").hide();
            window.parent.document.getElementById('coverbehidepage').style.display = "none";

            //$("#some-element").busyLoad("hide");
            blockUIForDownload();
        } else {
            return false;
        }
    }
</script>

<!--<div id="coverbehidepage" style="display: none" th:align="center">请耐心等待...</div>-->
<div>
    <div id="tabs">
        <a class="btn btn-default"
           th:href="@{/fileupdown/tomainpage(currentPage=${view.currentPage})}">上传</a>
        <a class="btn  btn-default"
           th:href="@{/fileupdown/tomodifypage(currentPage=${view.currentPage})}">更新</a>

        <a class="btn btn-default"
           th:href="@{/fileupdown/download(currentPage=${view.currentPage})}">
            下载</a>
        <a class="btn btn-primary"
           th:href="@{/fileupdown/todeletepage(currentPage=${view.currentPage})}">删除</a>
        <a class="btn btn-default"
           th:href="@{/fileupdown/tobroserfilepage(currentPage=${view.currentPage})}">查找</a>

        <a class="btn btn-default"
           th:href="@{/fileupdown/toprivilmanagepage(pageSize=12,currentPage=${view.currentPage})}">管理</a>

        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a onclick="alertMessageDiv()" href="#"><font color="#FF0000"
                                                      size="2"><u><strong>使用说明</strong></u></font></a>


        <p>

            <div id="">
                <form id="queryform" th:action="@{/fileupdown/deletebyquerycondition}" method="post"
                      style="margin-left: 0px;margin-top: 15px;margin-right: 35px;margin-bottom: 15px;">


                    <div>
                        <fieldset>
                            <!--<legend>查询条件</legend>-->
                            <table width="100%">
                                <tr>
                                    <td align="right">
                                        业务员:
                                    </td>
                                    <td>
                                        <select id="salor" style="width: 120px" name="view.salor" form="form0">
                                            <option value="" selected="selected"
                                            >
                                                请选择业务员
                                            </option>
                                            <option th:each="c:${employees}" th:value="${c.name}"
                                                    th:text="${c.name}"></option>

                                        </select>
                                    </td>
                                    <td align="right">订单编号:</td>
                                    <td><input type="text" id="orderno" name="view.orderNo" style="width:180px"
                                               form="form0"
                                               onkeypress="if(event.keyCode==13) {submitQueryByConditionbutton.click();return false;}"/>
                                    </td>
                                    <td align="right"> 顶目名称:</td>
                                    <td><input type="text" id="projectname" name="view.projectName"
                                               style="width:200px"
                                               form="form0"
                                               onkeypress="if(event.keyCode==13) {submitQueryByConditionbutton.click();return false;}"/>
                                    </td>
                                    <td></td>
                                    <td></td>

                                </tr>
                                <tr>
                                    <td align="right">设计师:</td>
                                    <td>
                                        <select id="engineer" style="width: 120px" name="view.engineer">
                                            <option value="" selected="selected">
                                                请选择设计师
                                            </option>
                                            <option th:each="c:${userInfos}" th:value="${c.uId}"
                                                    th:text="${c.fullName}"></option>
                                        </select>

                                    </td>
                                    <td align="right">文件名称:</td>
                                    <td><input type="text" id="filename" name="view.fileName" style="width:180px"
                                               form="form0"
                                               onkeypress="if(event.keyCode==13) {submitQueryByConditionbutton.click();return false;}"/>
                                    </td>
                                    <td align="right">最新上传时间:</td>
                                    <td colspan="2" th:align="left">
                                        <input type="text" style="width:120px" id="startnewestsavedate"
                                               readOnly="true"
                                               name="view.startNewestSaveDate" class="Wdate" form="form0"
                                               onkeypress="if(event.keyCode==13) {submitQueryByConditionbutton.click();return false;}"
                                               onclick="WdatePicker({dateFmt:'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'endnewestsavedate\')}'})"/>
                                        至：
                                        <input type="text" id="endnewestsavedate" style="width:120px"
                                               name="view.endnewestsavedate" class="Wdate" form="form0"
                                               onkeypress="if(event.keyCode==13) {submitQueryByConditionbutton.click();return false;}"
                                               onclick="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'#F{$dp.$D(\'startnewestsavedate\')}'})"/>
                                    </td>

                                    <td th:align="right">
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <input type="button" id="submitQueryByConditionbutton"
                                               onclick="submitQueryByCondition()" value="查询"/>
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <input type="button" onclick="deleteBySelect()" value="删除"/>
                                        <!--<input type="button" onclick="showcookie()" value="cookie"/>-->
                                </tr>
                            </table>
                        </fieldset>
                    </div>
                </form>

        <p>
        <div id="downloadpage">
            <form th:action="@{/fileupdown/deletebyquerycondition}" method="post" id="form0">
                <input type="hidden" id="maxPage" th:value="${view.maxPage}">
                <input type="hidden" id="n_currentPage" name="view.currentPage" th:value="${view.currentPage}"/>
                <input type="hidden" id="userName" name="view.userName" th:value="${view.userName}">
                <input type="hidden" id="passWord" name="view.password" th:value="${view.password}">
                <input type="hidden" id="flag" name="view.flag" th:value="${view.flag}">
                <input type="hidden" th:value="${extensionList}" id="extension">
                <input type="hidden" id="foldername">

                <!--FOLDER形式展示DIV-->
                <div id="folderdiv" style="display: block">

                    &nbsp;&nbsp;&nbsp;&nbsp;<input type="button" id="backfolder" disabled value="返回上一级"
                                                   onclick="backFolder3();">

                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <div id="innerfolderdiv">
                        <table width="100%">
                            <tbody id="showdatatable">
                            <div th:unless="${#lists.isEmpty(orderNumFolders)}">
                                <tr th:each="folderName ,iterStat: ${orderNumFolders}" align="left">
                                    <td>
                                        <input type="checkbox" th:value="${folderName}" th:id="${folderName}"
                                               name="downloadlist">
                                        <img src="/images/icon/Folder.png" align="middle" border="0"
                                             th:value="${folderName}" ondblclick="shownextfolderorfiles(this)"
                                             style="width: 30px; height: 30px; vertical-align: middle"
                                             th:text="${folderName}">

                                    </td>
                                </tr>
                            </div>
                            <div th:if="${#lists.isEmpty(orderNumFolders)}">
                                <tr>
                                    <td align="center">暂无文件清单信息</td>
                                </tr>
                            </div>
                            </tbody>

                            <tfoot id="s_tfoot">  <!-- 分页-->

                            <tr id="showdiv">

                                <td align="center">
                                    <span>第</span>
                                    <span th:text="${view.currentPage}" id="currentpagespan"> </span>
                                    <span>页|共</span>
                                    <span th:text="${view.maxPage}" id="maxpagespan"> </span>
                                    <span>页|共</span>
                                    <span th:text="${view.recordCount}" id="recordcountspan"> </span>
                                    <span>条记录 </span>
                                    <span id="image01">
                            <span th:if="${view.currentPage gt 1}">
                                    <img src="/images/page/sy-2.jpg" align="middle" border="0"
                                         style="width: 20px; height: 20px; vertical-align: middle"
                                         onClick="goPageone()"/>
                                    <img src="/images/page/syy-2.jpg" align="middle" border="0" onClick="goPrePage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;
                                </span>
                                </span>
                                    <span id="image02">
                            <span th:if="${view.currentPage le 1}">
                                <img src='/images/page/l-sy-2.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                                <img src='images/images/page/l-syy-2.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;
                            </span>
                            </span>
                                    <span id="image03">
                            <span th:if="${view.currentPage lt view.maxPage}">
                                    <img src="/images/page/xyy-2.jpg" align="middle" border="0" onClick="goAftPage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>
                                    <img src="/images/page/my-2.jpg" align="middle" border="0" onClick="goMaxPage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>
                            </span>
                                </span>
                                    <span id="image04">
                            <span th:if="${view.currentPage ge view.maxPage}">
                                <img src='/images/page/l-xyy-1.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                                <img src='/images/page/l-my-1.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                            </span>
                            </span>

                                    |&nbsp;到第
                                    <input onkeypress="if(event.keyCode==13) {gopage.click();return false;}"
                                           style="width: 50px"
                                           id="_tp" th:name="currentPage" type="text"
                                           th:value="${view.currentPage}"/>
                                    页&nbsp;
                                    <img src="/images/page/cx-2.jpg" id="gopage" onClick="goPage2()"
                                         style="width:20px;height:20px;vertical-align:middle">
                                </td>

                            </tr>


                            <tr style="display:none;" id="nodatadiv">
                                <td align="center">
                                    查无数据
                                </td>
                            </tr>

                            <tr class="page_btn clear" style="display:none;" id="pagetfoottr" align="center">
                                <td align="center">
                                       <span class="page_box">
                                           <a class="prev">上一页</a>
                                       <span class="num"><span class="current_page">1</span>
                                       <span style="padding:0 3px;">/</span>
                                           <span class="total"></span></span>
                                           <a class="next">下一页</a></span>
                                </td>
                            </tr>

                            </tfoot>
                        </table>
                    </div>
                </div>

            </form>

        </div>
    </div>


</div>


<div id="showMessageDiv" style="display: none">
    <div id="innershowMessageDiv">
        <div id="innershowMessageDiv1">
            <div id="innershowMessageDiv11" th:align="center">
                <font color="#FF0000" size="3" th:align="center"><strong>温馨小贴士</strong></font>
            </div>
            <div id="innershowMessageDiv12" th:align="left">
            </div>
        </div>
        <div id="innershowMessageDiv2" th:align="right">
            <p>
                <br>
                <input type="button" value="关闭" onclick="closeShowMessage()">
        </div>
    </div>
</div>


</div>
</body>
</html>
</html>




