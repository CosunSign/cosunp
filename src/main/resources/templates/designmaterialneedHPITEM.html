<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>品号明细</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap.css">
    <script src="/lib/jquery-3.3.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <script type="text/javascript" src="../static/lib/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/lib/bootstrap/js/bootstrap-select.min.js"></script>
    <script src="/lib/WdatePicker.js" type="text/javascript"></script>
    <script src="/lib/defaults-zh_CN.js" type="text/javascript"></script>
</head>
<style type="text/css">
    td, th {
        white-space: nowrap;
    }

    th {
        font-size: 11px;
    }
</style>
<script>

    let deptNameArray

    $(function () {
        window.parent.document.getElementById('content').style.display = "block";
        window.parent.document.getElementById('contentnew').style.display = "none";
        document.getElementById("coverbehidepage").style.display = "none";
        var flag = $("#flag").val ();
        var aflag = eval(flag);
        var customerNo2 = $ ("#customerNo2").val();
        deptNameArray = new Array("钣金", "精密", "精工", "喷涂", "图文", "亚克力", "装配", "包装");

        var len = $("#tabletblody > tr").length;
        var tbody = $("#tabletblody");
        var tr;
        var td;
        for (var i = 0; i < 5; i++) {
            tr = $("<tr id='tr" + (len + i) + "'></tr>");
            tr.append("<td id='tr" + (len + i) + "'>" + (len + i + 1) + "</td>");
            tr.append("<td style='width: 130px'><input type=\"text\" class=\"form-control\" readonly='readonly'></td>");
            tr.append("<td  style='width: 200px'><input  type=\"text\" class=\"form-control\" " +
                " onkeypress=\"return onKeyPress1(event,this)\"></td>");
            tr.append("<td  style='width: 200px'><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
            tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
            tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
            tr.append("<td style='width: 80px'><input type=\"text\"  class=\"form-control\" ></td>");
            td = "<td><select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
                "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
            for (var a = 0; a < deptNameArray.length; a++) {
                td += "  <option  value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
            }
            td += "  </select></td> ";

            tr.append(td);
            tr.append("<td><input type='text'  class=\"form-control\" placeholder='其它备注'></td>")
            tr.append("<td><input type='text'   class=\"form-control\" readonly='readonly'></td>")
            tr.append("<td><a id=\"savebutton\"\n" +
                "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,0)\">保存</a>" +
                " <a href=\"javascript:void(0);\"\n" +
                "    onclick=\"deleteTRA(this," + len + ",0);\">删除</a></td>");
           console.log("a")
            tr.prependTo(tbody);
            $('.selectpicker').selectpicker('refresh');

        }

        if (customerNo2.length > 0) {
            $("#customerNo").val(customerNo2);
            $('.selectpicker').selectpicker('refresh');
        }
        var productNo2 = $("#productNo2").val();
        if (productNo2.length > 0) {
            $("#productNo").val(productNo2);
            $('.selectpicker').selectpicker('refresh');
        }


        if (aflag == 1) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;添加成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 2) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;删除成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 3) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;更改成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 4) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;查询成功!";
            errormessagediv.style.color = "green";
        } else if (aflag == 5) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;客户单号已存在!";
            errormessagediv.style.color = "red";
        }else if (aflag == 6) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;该客户单号下的商品品号不存在!";
            errormessagediv.style.color = "red";
        }
    });

    function goPageone() {
        $("#n_currentPage").val(1);
        queryOrderHeadProductItemByCondition();
    }

    function goPrePage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 - 1 * 1);
        queryOrderHeadProductItemByCondition();
    }

    function goAftPage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 + 1 * 1);
        queryOrderHeadProductItemByCondition();
    }

    function goMaxPage() {
        $("#n_currentPage").val($("#maxPage").val());
        queryOrderHeadProductItemByCondition();
    }

    function goPriPageone() {
        $("#n_currentPage").val(1);
        queryOrderHeadProductItemByCondition();
    }

    function isNull(arg1) {
        if (arg1 == "null" || arg1 == null || arg1 == 0 || arg1 == "0") {
            return "";
        }
        return arg1;
    }

    function goPage2() {
        var tp = document.getElementById("_tp").value;//currentPage
        var max = $("#maxPage").val(); //maxPage
        tp = tp.trim();
        var r = /^\+?[0-9][0-9]*$/;
        if (!(r.test(tp))) {
            alert("页数输入有误，请重新输入!");
            $("#_tp").val(max);
            return false;
        } else if (parseInt(tp) == 0) {
            alert("页数必须大于0!");
            $("#_tp").val(max);
            return false;
        } else if (parseInt(tp) > parseInt(max)) {
            alert("不能大于总页数!");
            $("#_tp").val(max);
            return false;
        } else {
            $("#n_currentPage").val(tp);
            // document.forms["form0"].submit();
            queryOrderHeadProductItemByCondition();
        }
    }

    function goPriAftPage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 + 1 * 1);
        queryOrderHeadProductItemByCondition();
    }

    function goPriMaxPage() {
        $("#n_currentPage").val($("#maxPage").val());
        queryOrderHeadProductItemByCondition();
    }

    function goPriPrePage() {
        var currentpage = $("#_tp").val();
        $("#n_currentPage").val(currentpage * 1 - 1 * 1);
        queryOrderHeadProductItemByCondition();
    }

    var currentPage; //当前页
    var totalPage; //总多少页
    var totaldata; //总共多少记录
    var pageSize;//当前每页多少条
    var sortMethod;
    var sortByName;


    function queryOrderHeadProductItemByCondition() {
        var currentpage = $("#n_currentPage").val();
        window.parent.document.getElementById('coverbehidepage').style.display = "block";
        var formData = new FormData();
        formData.append('materialNameList2', $("#materialName").val());
        formData.append('mateiralNoList', $("#mateiralNo").val());
        formData.append('materialSpeciList2', $("#materialSpeci").val());
        formData.append('customerNoList', $("#customerNo").val());
        formData.append('productNoList', $("#productNo").val());
        formData.append('sortMethod', sortMethod);
        formData.append('sortByName', sortByName);
        formData.append('currentPage', currentpage);
        $.ajax({
            data: formData,
            type: "POST",
            url: "/design/queryOrderHeadProductItemByCondition",
            async: true,
            cache: false,
            contentType: false,
            processData: false,
            success: function (msg) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;查询成功!";
                errormessagediv.style.color = "green";
                var data = eval(msg);//将msg化为数;
                var tr = "";
                var image01 = $("#image01");
                var image02 = $("#image02");
                var image03 = $("#image03");
                var image04 = $("#image04");
                var maxpageid = $("#maxPage");
                var n_currentPage = $("#n_currentPage");
                var inputpage = $("#_tp");
                image01.html("");
                image02.html("");
                image03.html("");
                image04.html("");
                var td = "";
                var td2 = "";
                var tbody = $("#tabletblody");
                tbody.html("");
                if (data != null && data != "") {
                    $("#nodatadiv").hide();
                    $("#showdiv").show();
                    currentPage = data[0].currentPage; //当前页
                    totalPage = data[0].maxPage; //总多少页
                    totaldata = data[0].recordCount; //总共多少记录
                    pageSize = data[0].pageSize;
                    maxpageid.val(totalPage);
                    n_currentPage.val(currentPage);
                    inputpage.val(currentPage);
                    $.each(data, function (num) {
                        tr = $("<tr id='" + data[num].id + "'></tr>");
                        tr.append("<td>" + ((num + 1) + ((n_currentPage.val() - 1) * pageSize)) + "</td>");
                        tr.append("<td>" + isNull(data[num].mateiralNo) + "</td>");
                        tr.append("<td>" + isNull(data[num].materialName) + "</td>");
                        tr.append("<td>" + isNull(data[num].materialSpeci) + "</td>");
                        tr.append("<td>" + isNull(data[num].unit) + "</td>");
                        tr.append("<td>" + isNull(data[num].mateiralStock) + "</td>");
                        tr.append("<td>" + isNull(data[num].num) + "</td>");
                        tr.append("<td>" + isNull(data[num].useDeptName) + "</td>");
                        tr.append("<td>" + isNull(data[num].remark) + "</td>");
                        tr.append("<td>" + isNull(data[num].isCanUse2) + "</td>");
                        td = "<td>";
                        td += " <a class=\"btn btn-xs btn-primary\" \n" +
                            "onclick=\"updateOrderItemByheadId(this,'" + data[num].id + "');\">编辑</a>\n" +
                            "  <a class=\"btn btn-xs btn-primary\"\n" +
                            " onclick=\"deleteOrderItemByheadId('" + data[num].id + "',1);\">删除</a> " +
                            "</td>";
                        tr.append(td);
                        tr.appendTo(tbody);
                    });
                    $("#currentpagespan").html(currentPage);
                    $("#maxpagespan").html(totalPage);
                    $("#recordcountspan").html(totaldata);
                    if (currentPage > 1) {
                        var imange01str = '<img src="/images/page/sy-2.jpg"  onClick="goPriPageone()"  align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange01str += '<img src="/images/page/syy-2.jpg" onClick="goPriPrePage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image01.html(imange01str);
                    } else {
                        image01.html("");
                    }
                    if (currentPage <= 1) {
                        var image02str = '<img src="/images/page/l-sy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image02str += ' <img src="/images/page/l-syy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image02.html(image02str);
                    } else {
                        image02.html("");
                    }
                    if (currentPage < totalPage) {
                        var imange03str = '<img src="/images/page/xyy-2.jpg" onClick="goPriAftPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange03str += '<img src="/images/page/my-2.jpg" onClick="goPriMaxPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image03.html(imange03str);
                    } else {
                        image03.html("");
                    }
                    if (currentPage >= totalPage) {
                        var image04str = '<img src="/images/page/l-xyy-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image04str += ' <img src="/images/page/l-my-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image04.html(image04str);
                    } else {
                        image04.html("");
                    }
                } else {
                    $("#nodatadiv").show();
                    $("#showdiv").hide();
                }


                var len = $("#tabletblody > tr").length;
                var tbody = $("#tabletblody");
                var tr;
                var td;
                for (var i = 0; i < 5; i++) {
                    tr = $("<tr id='tr" + (len + i) + "'></tr>");
                    tr.append("<td id='tr" + (len + i) + "'>" + (len + i + 1) + "</td>");
                    tr.append("<td style='width: 130px'><input type=\"text\" class=\"form-control\" readonly='readonly'></td>");
                    tr.append("<td  style='width: 200px'><input  type=\"text\" class=\"form-control\" " +
                        " onkeypress=\"return onKeyPress1(event,this)\"></td>");
                    tr.append("<td  style='width: 200px'><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td style='width: 80px'><input type=\"text\"  class=\"form-control\" ></td>");
                    td = "<td><select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
                        "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
                    for (var a = 0; a < deptNameArray.length; a++) {
                        td += "  <option  value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
                    }
                    td += "  </select></td> ";

                    tr.append(td);
                    tr.append("<td><input type='text'  class=\"form-control\" placeholder='其它备注'></td>")
                    tr.append("<td><input type='text'   class=\"form-control\" readonly='readonly'></td>")
                    tr.append("<td><a id=\"savebutton\"\n" +
                        "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,0)\">保存</a>" +
                        " <a href=\"javascript:void(0);\"\n" +
                        "    onclick=\"deleteTRA(this," + len + ",0);\">删除</a></td>");
                    tr.prependTo(tbody);
                    $('.selectpicker').selectpicker('refresh');

                }

                window.parent.document.getElementById('coverbehidepage').style.display = "none";
            },
            error: function (msg) {
                window.parent.document.getElementById('coverbehidepage').style.display = "none";
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                errormessagediv.style.color = "red";
            }

        });
    }

    function deleteOrderItemByheadId(id, isFlag) {
        var customerNo = $("#customerNo").val()
        var productNo = $("#productNo").val()
        if (isFlag == 1) {
            window.location.href = "/design/deleteOrderItemByheadIdItem?id=" + id + "&customerNo=" + customerNo + "&productNo=" + productNo;
        }
    }

    function sortByAsc(titlename) {
        sortMethod = 'asc';
        sortByName = titlename;
        queryOrderHeadProductItemByCondition();
    }

    function sortByDesc(titlename) {
        sortMethod = 'desc';
        sortByName = titlename;
        queryOrderHeadProductItemByCondition();
    }


    var len;
    var data;


    function Trim(str) {
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }


    function checkNum(str) {
        $("#errormessage").hide();
        var newstr = str.value;
        if (Trim(newstr) != "") {
            var reg = new RegExp(/^-?\d+$/g);
            if (!reg.test(str.value)) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "数量只允许输入整数";
                errormessagediv.style.color = "red";
                str.value = "";
                return false;
            }
        }
    }

    function addSJIProdctHead() {
        $("#errormessage").hide();
        var customerNo = $("#customerNo").val();
        var productNo = $("#productNo").val();
        if (customerNo.length <= 0) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "新增前请选择客户单号!";
            errormessagediv.style.color = "red";
            return false;
        }

        if (productNo.length <= 0) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "新增前请选择商品品号!";
            errormessagediv.style.color = "red";
            return false;
        }


        len = $("#tabletblody > tr").length;
        var tbody = $("#tabletblody");
        var tr;
        var td;
        for (var i = 0; i < 5; i++) {
            tr = $("<tr id='tr" + (len + i) + "'></tr>");
            tr.append("<td id='tr" + (len + i) + "'>" + (len + i + 1) + "</td>");
            tr.append("<td style='width: 130px'><input type=\"text\" class=\"form-control\" readonly='readonly'></td>");
            tr.append("<td  style='width: 200px'><input  type=\"text\" class=\"form-control\" " +
                " onkeypress=\"return onKeyPress1(event,this)\"></td>");
            tr.append("<td  style='width: 200px'><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
            tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
            tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
            tr.append("<td style='width: 80px'><input type=\"text\"  class=\"form-control\" ></td>");
            td = "<td><select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
                "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
            for (var a = 0; a < deptNameArray.length; a++) {
                td += "  <option  value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
            }
            td += "  </select></td> ";

            tr.append(td);
            tr.append("<td><input type='text'  class=\"form-control\" placeholder='其它备注'></td>")
            tr.append("<td><input type='text'   class=\"form-control\" readonly='readonly'></td>")
            tr.append("<td><a id=\"savebutton\"\n" +
                "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,0)\">保存</a>" +
                " <a href=\"javascript:void(0);\"\n" +
                "    onclick=\"deleteTRA(this," + len + ",0);\">删除</a></td>");
            tr.prependTo(tbody);
            $('.selectpicker').selectpicker('refresh');

        }

        // len = $("#tabletblody > tr").length;
        // len++;
        // var tbody = $("#tabletblody");
        // var tr = $("<tr id='tr" + len + "'></tr>");
        //
        // tr.append("<td id='tr" + len + "'>" + len + "</td>");
        // tr.append("<td style='width: 130px'><input type=\"text\" class=\"form-control\" readonly='readonly'></td>");
        // tr.append("<td  style='width: 200px'><input  type=\"text\" class=\"form-control\" " +
        //     " onkeypress=\"return onKeyPress1(event,this)\"></td>");
        // tr.append("<td  style='width: 200px'><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
        // tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
        // tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
        // tr.append("<td style='width: 80px'><input type=\"text\"  class=\"form-control\" ></td>");
        //
        //
        // var td = "<td><select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
        //     "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
        // for (var a = 0; a < deptNameArray.length; a++) {
        //     td += "  <option  value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
        // }
        // td += "  </select></td> ";
        //
        // tr.append(td);
        // tr.append("<td><input type='text'  class=\"form-control\" placeholder='其它备注'></td>")
        // tr.append("<td><input type='text'   class=\"form-control\" readonly='readonly'></td>")
        // tr.append("<td><a id=\"savebutton\"\n" +
        //     "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,0)\">保存</a>" +
        //     " <a href=\"javascript:void(0);\"\n" +
        //     "    onclick=\"deleteTRA(this," + len + ",0);\">删除</a></td>");
        // tr.appendTo(tbody);
        // $('.selectpicker').selectpicker('refresh');
    }

    function deleteTRA(obj, len, id) {
        if (id == 0) {
            obj.parentElement.parentElement.remove();
            len--;
        } else {
            window.location.href = "/design/deleteOrderItemByheadIdItem?id=" + id;
        }
    }


    function trim(str) {
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }

    function onKeyPress1(e, obj) {
        console.log("aaa comin")
        var keyCode = null;
        if (e.which) keyCode = e.which; else if (e.keyCode) keyCode = e.keyCode;
        if (keyCode == 13) {
            querySpeficByMaterialName(obj);
            return false;
        }
        return true;
    }

    var datadata;

    function querySpeficByMaterialName(obj) {
        var materiName = $(obj).parent().parent().find("td").eq(2).find("input").eq(0).val();
        var data = JSON.stringify(materiName);
        var td;
        if (trim(materiName).length > 0) {
            $.ajax({
                data: data,
                type: "POST",
                url: "/design/queryMaterialSpecifiByCondition",
                async: true,
                cache: false,
                contentType: false,
                processData: false,
                success: function (msg) {
                    window.parent.document.getElementById('coverbehidepage').style.display = "none";
                    var data = eval(msg);
                    datadata = data;

                    td = "<input type=\"text\" value='" + datadata[0].unit + "' disabled='disabled' class=\"form-control\">";
                    $(obj).parent().parent().find("td").eq(4).html(td);

                    td = "<input type=\"text\" value='" + datadata[0].mateiralStock + "' disabled='disabled' class=\"form-control\">";
                    $(obj).parent().parent().find("td").eq(5).html(td);

                    td = "<input type=\"text\" value='" + datadata[0].mateiralNo + "' disabled='disabled' class=\"form-control\">";
                    $(obj).parent().parent().find("td").eq(1).html(td);

                    td = "<input type=\"text\" value='" + datadata[0].isCanUseStr + "' disabled='disabled' class=\"form-control\">";
                    $(obj).parent().parent().find("td").eq(9).html(td);

                    td = "<select onchange='showBySelect(this)' class=\"selectpicker show-tick form-control\"\n" +
                        "   data-live-search=\"true\" data-actions-box=\"true\"\n" +
                        "   data-selected-text-format=\"count > 1\">\n";
                    for (var aa = 0; aa < datadata.length; aa++) {
                        td += "  <option value=\"" + aa + "\">" + datadata[aa].materialSpeci + "</option>\n";
                    }
                    td += "  </select>";
                    $(obj).parent().parent().find("td").eq(3).html(td);


                    if (datadata.length > 1) {
                        td = "<select  onchange='showBySelect1(this)' class=\"selectpicker show-tick form-control\"\n" +
                            "   data-live-search=\"true\" data-actions-box=\"true\"\n" +
                            "   data-selected-text-format=\"count > 1\">\n";
                        for (var aa = 0; aa < datadata.length; aa++) {
                            td += "  <option value=\"" + aa + "\">" + datadata[aa].materialName + "</option>\n";
                        }
                        td += "  </select>";
                        $(obj).parent().parent().find("td").eq(2).html(td);

                    } else {
                        if (datadata.length == 1) {
                            td = "<input type=\"text\" value='" + datadata[0].materialName + "'  onkeypress=\"return onKeyPress1(event,this)\" class=\"form-control\">";
                        } else {
                            td = "<input type=\"text\" value=''  onkeypress=\"return onKeyPress1(event,this)\" class=\"form-control\">";
                        }
                        $(obj).parent().parent().find("td").eq(2).html(td);
                    }
                    $('.selectpicker').selectpicker('refresh');
                },
                error: function (msg) {
                    window.parent.document.getElementById('coverbehidepage').style.display = "none";
                    $("#errormessage").show();
                    var errormessagediv = document.getElementById("errormessage");
                    errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                    errormessagediv.style.color = "red";
                }
            });
        }
    }


    function showBySelect(obj) {
        var index = $(obj).parent().parent().find("td").eq(3).find("select").eq(0).val();
        var td;

        td = "<input type=\"text\" value='" + datadata[index].materialName + "'  onkeypress=\"return onKeyPress1(event,this)\" class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(2).html(td);

        td = "<input type=\"text\" value='" + datadata[index].unit + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(4).html(td);

        td = "<input type=\"text\" value='" + datadata[index].mateiralStock + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(5).html(td);

        td = "<input type=\"text\" value='" + datadata[index].mateiralNo + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(1).html(td);

        td = "<input type=\"text\" value='" + datadata[index].isCanUseStr + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(9).html(td);

    }


    function showBySelect1(obj) {
        var index = $(obj).parent().parent().find("td").eq(2).find("select").eq(0).val();

        var td;
        td = "<input type=\"text\" value='" + datadata[index].materialSpeci + "'  disabled='disabled' onkeypress=\"return onKeyPress1(event,this)\" class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(3).html(td);

        td = "<input type=\"text\" value='" + datadata[index].unit + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(4).html(td);

        td = "<input type=\"text\" value='" + datadata[index].mateiralStock + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(5).html(td);

        td = "<input type=\"text\" value='" + datadata[index].mateiralNo + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(1).html(td);

        td = "<input type=\"text\" value='" + datadata[index].isCanUseStr + "' disabled='disabled' class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(9).html(td);

        var indexstr = $(obj).parent().parent().find("td").eq(2).find("option:selected").text();

        td = "<input type=\"text\" value='" + indexstr + "'  onkeypress=\"return onKeyPress1(event,this)\" class=\"form-control\">";
        $(obj).parent().parent().find("td").eq(2).html(td);

    }


    function saveSJIProdctHead() {
        var isFalse = true;
        $("#errormessage").hide();
        var customerNo = $("#customerNo").val()[0];
        var productNo = $("#productNo").val()[0];
        var value = {
            customerNo: $("#customerNo").val()[0],
            productNo: $("#productNo").val()[0],
            mateiralNo: '',
            materialName: '',
            materialSpeci: '',
            unit: '',
            num: '',
            useDeptName: '',
            remark: '',
            isCanUse2: '',
            mateiralStock: '',
            currentpage: $("#n_currentPage").val()
        };

        var set = [];
        var materialNo;
        var materialName;
        var materialSpeci;
        var unit;
        var stockNum;
        var isCanUse;
        var customerNo;
        var productNo;
        var num;
        var useDeptName;
        var remark;
        var homeyMa;

        var errormessagediv = document.getElementById("errormessage");
        var rowlen = 0;
        var materialNoArr = [];

        $("#tabletblody").find("tr").each(function () {
            rowlen++;
            value = {
                customerNo: $("#customerNo").val()[0],
                productNo: $("#productNo").val()[0],
                mateiralNo: '',
                materialName: '',
                materialSpeci: '',
                unit: '',
                num: '',
                useDeptName: '',
                remark: '',
                isCanUse2: '',
                mateiralStock: '',
                currentpage: $("#n_currentPage").val()
            };

            materialNo = $(this).children().eq(1).find("input").val();


            if (typeof materialNo == "undefined") {
                homeyMa = $(this).children().eq(1).text();
                materialNoArr.push(Trim(homeyMa));
                return true;
            }

            materialName = $(this).children().eq(2).find("input").val();
            if (materialName.length == 0) {
                materialName = $(this).children().eq(2).find("option:selected").eq(0).text();
            }

            materialSpeci = $(this).children().eq(3).find("input").eq(0).val();
            if (materialSpeci.length == 0) {
                materialSpeci = $(this).children().eq(3).find("option:selected").eq(0).text();
            }

            unit = $(this).children().eq(4).find("input").eq(0).val();
            stockNum = $(this).children().eq(5).find("input").eq(0).val();
            isCanUse = $(this).children().eq(9).find("input").eq(0).val();

            num = $(this).children().eq(6).find("input").eq(0).val();
            useDeptName = $(this).children().eq(7).find("select").eq(0).val();
            remark = $(this).children().eq(8).find("input").eq(0).val();


            if (Trim(materialNo).length > 0) {

                materialNoArr.push(Trim(materialNo));

                if (materialNo.length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行材料品号不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                if (materialName.length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行材料品名不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                if (materialSpeci.length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行材料规格不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                if (customerNo.length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行客户单号不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                if (productNo.length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行商品品号不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                if (Trim(num).length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行数量不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                if (Trim(useDeptName).length <= 0) {
                    $("#errormessage").show();
                    errormessagediv.innerHTML = "第" + rowlen + "行便用部门不能为空!";
                    errormessagediv.style.color = "red";
                    isFalse = false;
                    return false;
                }

                value["mateiralNo"] = Trim(materialNo);
                value["materialName"] = Trim(materialName);
                value["materialSpeci"] = Trim(materialSpeci);
                value["unit"] = Trim(unit);
                value["num"] = Trim(num);
                value["useDeptName"] = Trim(useDeptName);
                value["remark"] = Trim(remark);
                value["isCanUse2"] = Trim(isCanUse);
                value["mateiralStock"] = Trim(stockNum);
                set.push(value);
            }
        });

        var dubArray = materialNoArr.duplicate();

        if (dubArray.length > 0) {
            $("#errormessage").show();
            errormessagediv.innerHTML = "同一商品下不能出现重复料号:" + dubArray;
            errormessagediv.style.color = "red";
            isFalse = false;
            return false;
        }

        if (set.length == 0) {
            $("#errormessage").show();
            errormessagediv.innerHTML = "保存前请输入数据!";
            errormessagediv.style.color = "red";
            isFalse = false;
            return false;
        }

        if (!isFalse) {
            return isFalse;
        }

        var data = JSON.stringify(set);

        window.parent.document.getElementById('coverbehidepage').style.display = "block";
        $.ajax({
            data: data,
            type: "POST",
            url: "/design/saveSJIHeadPDateToMysql2",
            contentType: "application/json",//上传内容格式为json结构
            success: function (msg) {
                var data = eval(msg);//将msg化为数;
                var tr = "";
                var image01 = $("#image01");
                var image02 = $("#image02");
                var image03 = $("#image03");
                var image04 = $("#image04");
                var maxpageid = $("#maxPage");
                var n_currentPage = $("#n_currentPage");
                var inputpage = $("#_tp");
                var flag;
                image01.html("");
                image02.html("");
                image03.html("");
                image04.html("");
                var td = "";
                var td2 = "";
                var tbody = $("#tabletblody");
                tbody.html("");
                flag = data[0].flag;
                console.log(flag);
                if (data != null && data != "") {
                    $("#nodatadiv").hide();
                    $("#showdiv").show();
                    currentPage = data[0].currentPage; //当前页
                    totalPage = data[0].maxPage; //总多少页
                    totaldata = data[0].recordCount; //总共多少记录
                    pageSize = data[0].pageSize;
                    if (flag == 1) {
                        $("#errormessage").show();
                        var errormessagediv = document.getElementById("errormessage");
                        errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;添加成功!";
                        errormessagediv.style.color = "green";
                    } else if (flag == 5) {
                        $("#errormessage").show();
                        var errormessagediv = document.getElementById("errormessage");
                        errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;材料品号已存在!";
                        errormessagediv.style.color = "red";
                    }else if (flag == 6) {
                        $("#errormessage").show();
                        var errormessagediv = document.getElementById("errormessage");
                        errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;客户单号下的商品品名不存在!";
                        errormessagediv.style.color = "red";
                    }
                    maxpageid.val(totalPage);
                    n_currentPage.val(currentPage);
                    inputpage.val(currentPage);
                    $.each(data, function (num) {
                        tr = $("<tr id='" + data[num].id + "'></tr>");
                        tr.append("<td>" + ((num + 1) + ((n_currentPage.val() - 1) * pageSize)) + "</td>");
                        tr.append("<td>" + isNull(data[num].mateiralNo) + "</td>");
                        tr.append("<td>" + isNull(data[num].materialName) + "</td>");
                        tr.append("<td>" + isNull(data[num].materialSpeci) + "</td>");
                        tr.append("<td>" + isNull(data[num].unit) + "</td>");
                        tr.append("<td>" + isNull(data[num].mateiralStock) + "</td>");
                        tr.append("<td>" + isNull(data[num].num) + "</td>");
                        tr.append("<td>" + isNull(data[num].useDeptName) + "</td>");
                        tr.append("<td>" + isNull(data[num].remark) + "</td>");
                        tr.append("<td>" + isNull(data[num].isCanUse2) + "</td>");
                        td = "<td>";
                        td += " <a class=\"btn btn-xs btn-primary\" \n" +
                            "onclick=\"updateOrderItemByheadId(this,'" + data[num].id + "');\">编辑</a>\n" +
                            "  <a class=\"btn btn-xs btn-primary\"\n" +
                            " onclick=\"deleteOrderItemByheadId('" + data[num].id + "',1);\">删除</a> " +
                            "</td>";
                        tr.append(td);
                        tr.appendTo(tbody);
                    });
                    $("#currentpagespan").html(currentPage);
                    $("#maxpagespan").html(totalPage);
                    $("#recordcountspan").html(totaldata);
                    if (currentPage > 1) {
                        var imange01str = '<img src="/images/page/sy-2.jpg"  onClick="goPriPageone()"  align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange01str += '<img src="/images/page/syy-2.jpg" onClick="goPriPrePage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image01.html(imange01str);
                    } else {
                        image01.html("");
                    }
                    if (currentPage <= 1) {
                        var image02str = '<img src="/images/page/l-sy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image02str += ' <img src="/images/page/l-syy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image02.html(image02str);
                    } else {
                        image02.html("");
                    }
                    if (currentPage < totalPage) {
                        var imange03str = '<img src="/images/page/xyy-2.jpg" onClick="goPriAftPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange03str += '<img src="/images/page/my-2.jpg" onClick="goPriMaxPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image03.html(imange03str);
                    } else {
                        image03.html("");
                    }
                    if (currentPage >= totalPage) {
                        var image04str = '<img src="/images/page/l-xyy-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image04str += ' <img src="/images/page/l-my-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image04.html(image04str);
                    } else {
                        image04.html("");
                    }
                } else {
                    $("#nodatadiv").show();
                    $("#showdiv").hide();
                }


                var len = $("#tabletblody > tr").length;
                var tbody = $("#tabletblody");
                var tr;
                var td;
                for (var i = 0; i < 5; i++) {
                    tr = $("<tr id='tr" + (len + i) + "'></tr>");
                    tr.append("<td id='tr" + (len + i) + "'>" + (len + i + 1) + "</td>");
                    tr.append("<td style='width: 130px'><input type=\"text\" class=\"form-control\" readonly='readonly'></td>");
                    tr.append("<td  style='width: 200px'><input  type=\"text\" class=\"form-control\" " +
                        " onkeypress=\"return onKeyPress1(event,this)\"></td>");
                    tr.append("<td  style='width: 200px'><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td style='width: 80px'><input type=\"text\"  class=\"form-control\" ></td>");
                    td = "<td><select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
                        "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
                    for (var a = 0; a < deptNameArray.length; a++) {
                        td += "  <option  value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
                    }
                    td += "  </select></td> ";

                    tr.append(td);
                    tr.append("<td><input type='text'  class=\"form-control\" placeholder='其它备注'></td>")
                    tr.append("<td><input type='text'   class=\"form-control\" readonly='readonly'></td>")
                    tr.append("<td><a id=\"savebutton\"\n" +
                        "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,0)\">保存</a>" +
                        " <a href=\"javascript:void(0);\"\n" +
                        "    onclick=\"deleteTRA(this," + len + ",0);\">删除</a></td>");
                    tr.prependTo(tbody);
                    $('.selectpicker').selectpicker('refresh');

                }

                window.parent.document.getElementById('coverbehidepage').style.display = "none";
            },
            error: function (msg) {
                window.parent.document.getElementById('coverbehidepage').style.display = "none";
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                errormessagediv.style.color = "red";
            }

        });


    }


    Array.prototype.duplicate = function () {
        var tmp = [];
        this.concat().sort().sort(function (a, b) {
            if (a == b && tmp.indexOf(a) === -1) tmp.push(a);
        });
        return tmp;
    }


    function saveSJIHeadPDateToMysql(obj, id) {
        $("#errormessage").hide();
        var materialNo;
        var materialName;
        var materialSpeci;
        var unit;
        var stockNum;
        var isCanUse;
        var customerNo;
        var productNo;
        customerNo = $("#customerNo").val();
        productNo = $("#productNo").val();
        if (id == 0) {
            materialNo = $(obj).parent().parent().find("td").eq(1).find("input").eq(0).val();
            materialName = $(obj).parent().parent().find("td").eq(2).find("input").eq(0).val();
            if (materialName.length == 0) {
                materialName = $(obj).parent().parent().find("td").eq(2).find("option:selected").eq(0).text();
            }
            materialSpeci = $(obj).parent().parent().find("td").eq(3).find("input").eq(0).val();
            if (materialSpeci.length == 0) {
                materialSpeci = $(obj).parent().parent().find("td").eq(3).find("option:selected").eq(0).text();
            }

            unit = $(obj).parent().parent().find("td").eq(4).find("input").eq(0).val();
            stockNum = $(obj).parent().parent().find("td").eq(5).find("input").eq(0).val();
            isCanUse = $(obj).parent().parent().find("td").eq(9).find("input").eq(0).val();

            if (materialName.length <= 0) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "材料品名不能为空!";
                errormessagediv.style.color = "red";
                return false;
            }

            if (materialNo.length <= 0) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "材料品号不能为空!";
                errormessagediv.style.color = "red";
                return false;
            }

            if (materialSpeci.length <= 0) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "材料规格不能为空!";
                errormessagediv.style.color = "red";
                return false;
            }

            if (customerNo.length <= 0) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "客户单号不能为空!";
                errormessagediv.style.color = "red";
                return false;
            }

            if (productNo.length <= 0) {
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "商品品号不能为空!";
                errormessagediv.style.color = "red";
                return false;
            }

        } else {
            materialNo = $(obj).parent().parent().find("td").eq(1).text();
        }

        var num = $(obj).parent().parent().find("td").eq(6).find("input").eq(0).val();
        var useDeptName = $(obj).parent().parent().find("td").eq(7).find("select").eq(0).val();
        var remark = $(obj).parent().parent().find("td").eq(8).find("input").eq(0).val();


        if (Trim(num).length <= 0) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "数量不能为空!";
            errormessagediv.style.color = "red";
            return false;
        }

        if (Trim(useDeptName).length <= 0) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "便用部门不能为空!";
            errormessagediv.style.color = "red";
            return false;
        }


        var jsonarray = {
            "customerNo": customerNo[0],
            "productNo": productNo[0],
            "mateiralNo": materialNo,
            "materialName": materialName,
            "materialSpeci": materialSpeci,
            "unit": unit,
            "num": num,
            "useDeptName": useDeptName,
            "remark": remark,
            "isCanUse2": isCanUse,
            "mateiralStock": stockNum,
            "currentpage": $("#n_currentPage").val(),
            "id": id
        };

        console.log(jsonarray)
        var data = JSON.stringify(jsonarray);
        window.parent.document.getElementById('coverbehidepage').style.display = "block";
        $.ajax({
            data: data,
            type: "POST",
            url: "/design/saveSJIHeadPDateToMysql",
            contentType: "application/json",//上传内容格式为json结构
            success: function (msg) {
                var data = eval(msg);//将msg化为数;
                var tr = "";
                var image01 = $("#image01");
                var image02 = $("#image02");
                var image03 = $("#image03");
                var image04 = $("#image04");
                var maxpageid = $("#maxPage");
                var n_currentPage = $("#n_currentPage");
                var inputpage = $("#_tp");
                var flag;
                image01.html("");
                image02.html("");
                image03.html("");
                image04.html("");
                var td = "";
                var td2 = "";
                var tbody = $("#tabletblody");
                tbody.html("");
                flag = data[0].flag;
                console.log(flag)
                if (data != null && data != "") {
                    $("#nodatadiv").hide();
                    $("#showdiv").show();
                    currentPage = data[0].currentPage; //当前页
                    totalPage = data[0].maxPage; //总多少页
                    totaldata = data[0].recordCount; //总共多少记录
                    pageSize = data[0].pageSize;
                    if (flag == 1) {
                        $("#errormessage").show();
                        var errormessagediv = document.getElementById("errormessage");
                        errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;添加成功!";
                        errormessagediv.style.color = "green";
                    } else if (flag == 5) {
                        $("#errormessage").show();
                        var errormessagediv = document.getElementById("errormessage");
                        errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;材料品号已存在!";
                        errormessagediv.style.color = "red";
                    }else if (flag == 6) {
                        $("#errormessage").show();
                        var errormessagediv = document.getElementById("errormessage");
                        errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;保存无效,客户单号下的商品品名不存在!";
                        errormessagediv.style.color = "red";
                    }
                    maxpageid.val(totalPage);
                    n_currentPage.val(currentPage);
                    inputpage.val(currentPage);
                    $.each(data, function (num) {
                        tr = $("<tr id='" + data[num].id + "'></tr>");
                        tr.append("<td>" + ((num + 1) + ((n_currentPage.val() - 1) * pageSize)) + "</td>");
                        tr.append("<td>" + isNull(data[num].mateiralNo) + "</td>");
                        tr.append("<td>" + isNull(data[num].materialName) + "</td>");
                        tr.append("<td>" + isNull(data[num].materialSpeci) + "</td>");
                        tr.append("<td>" + isNull(data[num].unit) + "</td>");
                        tr.append("<td>" + isNull(data[num].mateiralStock) + "</td>");
                        tr.append("<td>" + isNull(data[num].num) + "</td>");
                        tr.append("<td>" + isNull(data[num].useDeptName) + "</td>");
                        tr.append("<td>" + isNull(data[num].remark) + "</td>");
                        tr.append("<td>" + isNull(data[num].isCanUse2) + "</td>");
                        td = "<td>";
                        td += " <a class=\"btn btn-xs btn-primary\" \n" +
                            "onclick=\"updateOrderItemByheadId(this,'" + data[num].id + "');\">编辑</a>\n" +
                            "  <a class=\"btn btn-xs btn-primary\"\n" +
                            " onclick=\"deleteOrderItemByheadId('" + data[num].id + "',1);\">删除</a> " +
                            "</td>";
                        tr.append(td);
                        tr.appendTo(tbody);
                    });
                    $("#currentpagespan").html(currentPage);
                    $("#maxpagespan").html(totalPage);
                    $("#recordcountspan").html(totaldata);
                    if (currentPage > 1) {
                        var imange01str = '<img src="/images/page/sy-2.jpg"  onClick="goPriPageone()"  align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange01str += '<img src="/images/page/syy-2.jpg" onClick="goPriPrePage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image01.html(imange01str);
                    } else {
                        image01.html("");
                    }
                    if (currentPage <= 1) {
                        var image02str = '<img src="/images/page/l-sy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image02str += ' <img src="/images/page/l-syy-2.jpg" align="middle" border="0px"';
                        image02str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image02.html(image02str);
                    } else {
                        image02.html("");
                    }
                    if (currentPage < totalPage) {
                        var imange03str = '<img src="/images/page/xyy-2.jpg" onClick="goPriAftPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/> </a>';
                        imange03str += '<img src="/images/page/my-2.jpg" onClick="goPriMaxPage()" align="middle" border="0" style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp; </a>';
                        image03.html(imange03str);
                    } else {
                        image03.html("");
                    }
                    if (currentPage >= totalPage) {
                        var image04str = '<img src="/images/page/l-xyy-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>';
                        image04str += ' <img src="/images/page/l-my-1.jpg" align="middle" border="0px"';
                        image04str += ' style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;';
                        image04.html(image04str);
                    } else {
                        image04.html("");
                    }
                } else {
                    $("#nodatadiv").show();
                    $("#showdiv").hide();
                }
                window.parent.document.getElementById('coverbehidepage').style.display = "none";

                var len = $("#tabletblody > tr").length;
                var tbody = $("#tabletblody");
                var tr;
                var td;
                for (var i = 0; i < 5; i++) {
                    tr = $("<tr id='tr" + (len + i) + "'></tr>");
                    tr.append("<td id='tr" + (len + i) + "'>" + (len + i + 1) + "</td>");
                    tr.append("<td style='width: 130px'><input type=\"text\" class=\"form-control\" readonly='readonly'></td>");
                    tr.append("<td  style='width: 200px'><input  type=\"text\" class=\"form-control\" " +
                        " onkeypress=\"return onKeyPress1(event,this)\"></td>");
                    tr.append("<td  style='width: 200px'><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td><input type=\"text\"  class=\"form-control\"  readonly='readonly'></td>");
                    tr.append("<td style='width: 80px'><input type=\"text\"  class=\"form-control\" ></td>");
                    td = "<td><select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
                        "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
                    for (var a = 0; a < deptNameArray.length; a++) {
                        td += "  <option  value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
                    }
                    td += "  </select></td> ";

                    tr.append(td);
                    tr.append("<td><input type='text'  class=\"form-control\" placeholder='其它备注'></td>")
                    tr.append("<td><input type='text'   class=\"form-control\" readonly='readonly'></td>")
                    tr.append("<td><a id=\"savebutton\"\n" +
                        "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,0)\">保存</a>" +
                        " <a href=\"javascript:void(0);\"\n" +
                        "    onclick=\"deleteTRA(this," + len + ",0);\">删除</a></td>");
                    tr.prependTo(tbody);
                    $('.selectpicker').selectpicker('refresh');

                }


            },
            error: function (msg) {
                window.parent.document.getElementById('coverbehidepage').style.display = "none";
                $("#errormessage").show();
                var errormessagediv = document.getElementById("errormessage");
                errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;系统发生错误!";
                errormessagediv.style.color = "red";
            }

        });


    }


    function updateOrderItemByheadId(obj, id) {
        var num = $(obj).parent().parent().find("td").eq(6).text();
        var useDeptName = $(obj).parent().parent().find("td").eq(7).text();
        var remark = $(obj).parent().parent().find("td").eq(8).text();


        $(obj).parent().parent().find("td").eq(6).html("<input type=\"text\"  value='" + num + "' class=\"form-control\">")


        var td = "<select id=\"name\"  class=\"selectpicker show-tick form-control\"\n" +
            "   data-live-search=\"true\" data-actions-box=\"true\" >\n";
        for (var a = 0; a < deptNameArray.length; a++) {
            if (useDeptName.indexOf(deptNameArray[a]) != -1) {
                td += "  <option selected='selected' value=\"" + deptNameArray[a] + "\" >" + deptNameArray[a] + "</option>\n";
            } else {
                td += "  <option value=\"" + deptNameArray[a] + "\">" + deptNameArray[a] + "</option>\n";
            }
        }
        td += "  </select> ";


        $(obj).parent().parent().find("td").eq(7).html(td);


        $(obj).parent().parent().find("td").eq(8).html("<input type=\"text\"  value='" + remark + "' class=\"form-control\">")
        $(obj).parent().parent().find("td").eq(10).html("<a id=\"savebutton\"\n" +
            "    href=\"javascript:void(0);\" onclick=\"saveSJIHeadPDateToMysql(this,'" + id + "')\">保存</a>" +
            " <a href=\"javascript:void(0);\"\n" +
            "    onclick=\"deleteTRA(this," + len + "," + id + ");\">删除</a>");

        $('.selectpicker').selectpicker('refresh');

    }

</script>
<div>
    <div id="coverbehidepage"></div>
    <div id="coverbehidepagetwo"></div>
    <div id="coverbehidepagethree"></div>

    <ul id="myTab" class="nav nav-tabs">
        <li>
            <a th:href="@{/design/toMaterialNeed}">客户单号</a>
        </li>
        <li>
            <a th:href="@{/design/toHeadProduct}">商品品号</a>
        </li>
        <li class="active">
            <a href="#compreAttendRecord" data-toggle="tab">材料品号</a>
        </li>

    </ul>
    <br>
    <p>

    <div id='compreAttendRecord'>
        <div id='app'>
            <form>
                <input type="hidden" id="flag" th:value="${flag}">
                <input type="hidden" id="maxPage" th:value="${orderHead.maxPage}">
                <input type="hidden" id="customerNo2" th:value="${customerNo}">
                <input type="hidden" id="productNo2" th:value="${productNo}">
                <input type="hidden" id="n_currentPage" name="view.currentPage" th:value="${orderHead.currentPage}"/>
                <input type="hidden" id="salorEmpListA" th:value="${salorEmpListA}">

                <div class="panel panel-primary">
                    <div class="panel-body form-inline">
                        <table width="100%">
                            <tr>


                                <td style="text-align: right">
                                    <label>材料品名：</label>
                                </td>
                                <td>
                                    <label>
                                        <select id="materialName" multiple class="selectpicker show-tick form-control"
                                                data-live-search="true" data-actions-box="true"
                                                data-selected-text-format="count > 1">
                                            　　
                                            <option th:each="c:${pmaterialNameList}" th:value="${c}"
                                                    th:text="${c}"></option>
                                        </select>
                                    </label>
                                </td>

                                <td style="text-align: right">
                                    <label>材料品号：</label>
                                </td>
                                <td>
                                    <label>
                                        <select id="mateiralNo" multiple class="selectpicker show-tick form-control"
                                                data-live-search="true" data-actions-box="true"
                                                data-selected-text-format="count > 1">
                                            　　
                                            <option th:each="c:${mateiralNoList}" th:value="${c}"
                                                    th:text="${c}"></option>
                                        </select>
                                    </label>
                                </td>

                                <td style="text-align: right">
                                    <label>规格：</label>
                                </td>
                                <td>
                                    <label>
                                        <select id="materialSpeci" multiple class="selectpicker show-tick form-control"
                                                data-live-search="true" data-actions-box="true"
                                                data-selected-text-format="count > 1">
                                            　　
                                            <option th:each="c:${materialSpeciList}" th:value="${c}"
                                                    th:text="${c}"></option>
                                        </select>
                                    </label>
                                </td>


                            </tr>
                            <tr>
                                <td style="text-align: right">
                                    <label>客户单号：</label>
                                </td>
                                <td>
                                    <label>
                                        <select id="customerNo" multiple class="selectpicker show-tick form-control"
                                                data-live-search="true" data-actions-box="true"
                                                data-selected-text-format="count > 1">
                                            　　
                                            <option th:each="c:${customerNoList}" th:value="${c}"
                                                    th:text="${c}"></option>
                                        </select>
                                    </label>
                                </td>

                                <td style="text-align: right">
                                    <label>商品品号：</label>
                                </td>
                                <td>
                                    <label>
                                        <select id="productNo" multiple class="selectpicker show-tick form-control"
                                                data-live-search="true" data-actions-box="true"
                                                data-selected-text-format="count > 1">
                                            　　
                                            <option th:each="c:${productNoList}" th:value="${c}"
                                                    th:text="${c}"></option>
                                        </select>
                                    </label>
                                </td>

                                <td style="text-align: left" colspan="2">
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-primary"
                                       href="javascript:void(0);"
                                       onclick="queryOrderHeadProductItemByCondition()">查找</a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-primary"
                                       href="javascript:void(0);" onclick="addSJIProdctHead()">新增</a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <a class="btn btn-primary"
                                       href="javascript:void(0);" onclick="saveSJIProdctHead()">保存</a>
                                </td>
                                <td>
                                    <div style="display: none" id="errormessage">

                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </form>
            <table class="table table-bordered table-hover table-striped text-center hongmei" id="showlistbody">
                <thead style="background-color:lightsteelblue">
                <tr>
                    <th style="text-align: center"> 序号</th>
                    <th style="text-align: center; ">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('mateiralNo')" aria-hidden="true"></i>
                        材料品号
                        <i class="fa fa-sort-desc" onclick="sortByDesc('mateiralNo')" aria-hidden="true"></i>
                    </th>

                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('materialName')" aria-hidden="true"></i>
                        材料品名
                        <i class="fa fa-sort-desc" onclick="sortByDesc('materialName')" aria-hidden="true"></i>
                    </th>
                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('materialSpeci')" aria-hidden="true"></i>
                        规格
                        <i class="fa fa-sort-desc" onclick="sortByDesc('materialSpeci')" aria-hidden="true"></i>
                    </th>
                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('unit')" aria-hidden="true"></i>
                        单位
                        <i class="fa fa-sort-desc" onclick="sortByDesc('unit')" aria-hidden="true"></i>
                    </th>
                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('mateiralStock')" aria-hidden="true"></i>
                        库存数量
                        <i class="fa fa-sort-desc" onclick="sortByDesc('mateiralStock')" aria-hidden="true"></i>
                    </th>

                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('num')" aria-hidden="true"></i>
                        数量
                        <i class="fa fa-sort-desc" onclick="sortByDesc('num')" aria-hidden="true"></i>
                    </th>

                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('useDeptName')" aria-hidden="true"></i>
                        使用车间
                        <i class="fa fa-sort-desc" onclick="sortByDesc('useDeptName')" aria-hidden="true"></i>
                    </th>

                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('remark')" aria-hidden="true"></i>
                        其它备注
                        <i class="fa fa-sort-desc" onclick="sortByDesc('remark')" aria-hidden="true"></i>
                    </th>

                    <th style="text-align: center">
                        <i class="fa fa-sort-asc" onclick="sortByAsc('isCanUse')" aria-hidden="true"></i>
                        是否可用
                        <i class="fa fa-sort-desc" onclick="sortByDesc('isCanUse')" aria-hidden="true"></i>
                    </th>

                    <th style="text-align: center">操作</th>
                </tr>
                </thead>
                <tbody id="tabletblody">
                <!--v-for中的数据不再是直接从data中获取，而是通过search方法对data中的数据进行过滤再显示-->
                <div th:unless="${#lists.isEmpty(orderList)}">
                    <div th:each="order,iterStat: ${orderList}" align="center">
                        <tr th:ondblclick="showOrderItemByOrderNo([[${order.id}]])">
                            <td align="center"
                                th:text="${(iterStat.index+1)}+${orderHead.currentPage-1}*${orderHead.pageSize}"></td>
                            <td align="center" th:text="${order.mateiralNo}"></td>
                            <td align="center" th:text="${order.materialName}"></td>
                            <td align="center" th:text="${order.materialSpeci}"></td>
                            <td align="center" th:text="${order.unit}"></td>
                            <td align="center" th:text="${order.mateiralStock}"></td>
                            <td align="center" th:text="${order.num}"></td>
                            <td align="center" th:text="${order.useDeptName}"></td>
                            <td align="center" th:text="${order.remark}"></td>
                            <td align="center" th:text="${order.isCanUse2}"></td>
                            <td align="center">
                                <a class="btn btn-xs btn-primary"
                                   th:onclick="updateOrderItemByheadId(this,[[${order.id}]]);">编辑</a>
                                <a class="btn btn-xs btn-primary"
                                   th:onclick="deleteOrderItemByheadId([[${order.id}]],1);">删除</a>
                            </td>
                        </tr>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(orderList)}">
                    <tr>
                        <td colspan="11">
                            查无数据
                        </td>
                    </tr>
                </div>
                </tbody>

                <tfoot id="s_tfoot">
                <tr id="showdiv">

                    <td colspan="11" align="center">
                        <span>第</span>
                        <span th:text="${orderHead.currentPage}" id="currentpagespan"> </span>
                        <span>页|共</span>
                        <span th:text="${orderHead.maxPage}" id="maxpagespan"> </span>
                        <span>页|共</span>
                        <span th:text="${orderHead.recordCount}" id="recordcountspan"> </span>
                        <span>条记录 </span>
                        <span id="image01">
                            <span th:if="${orderHead.currentPage gt 1}">
                                    <img src="/images/page/sy-2.jpg" align="middle" border="0"
                                         style="width: 20px; height: 20px; vertical-align: middle"
                                         onClick="goPageone()"/>
                                    <img src="/images/page/syy-2.jpg" align="middle" border="0" onClick="goPrePage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;

                                </span>
                                </span>
                        <span id="image02">
                            <span th:if="${orderHead.currentPage le 1}">
                                <img src='/images/page/l-sy-2.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                                <img src='images/images/page/l-syy-2.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>&nbsp;&nbsp;
                            </span>
                            </span>
                        <span id="image03">
                            <span th:if="${orderHead.currentPage lt orderHead.maxPage}">
                                    <img src="/images/page/xyy-2.jpg" align="middle" border="0" onClick="goAftPage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>
                                    <img src="/images/page/my-2.jpg" align="middle" border="0" onClick="goMaxPage()"
                                         style="width: 20px; height: 20px; vertical-align: middle"/>
                            </span>
                                </span>
                        <span id="image04">
                            <span th:if="${orderHead.currentPage ge orderHead.maxPage}">
                                <img src='/images/page/l-xyy-1.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                                <img src='/images/page/l-my-1.jpg' align='middle' border='0px'
                                     style="width: 20px; height: 20px; vertical-align: middle"/>
                            </span>
                            </span>

                        |&nbsp;到第
                        <input onkeypress="if(event.keyCode==13) {gopage.click();return false;}"
                               style="width: 50px"
                               id="_tp" th:name="currentPage" type="text" th:value="${orderHead.currentPage}"/>
                        页&nbsp;
                        <img src="/images/page/cx-2.jpg" id="gopage" onClick="goPage2()"
                             style="width:20px;height:20px;vertical-align:middle">
                    </td>

                </tr>


                <tr style="display:none;" id="nodatadiv">
                    <td colspan="11" align="center">
                        查无数据
                    </td>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>


    </body>
</html>